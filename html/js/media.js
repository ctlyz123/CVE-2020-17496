/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["saving"]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,["commentminchars"]);window.vBulletin.media=window.vBulletin.media||{};(function(H){var N=["#media-tab",".album-widget"];if(!vBulletin.pageHasSelectors(N)){return false}var S={mediaTypeFilter:false,currentMediaPage:Number(H("#mediaCurrentPage").val())||1,currentGalleryPage:1,currentNodeId:0,currentUserId:0,profileMediaDetailContainer:false,currentDateFilter:"time_lastmonth"};var P=H("#media-tab"),B,L,E;window.vBulletin.media.calculatePhotosPerPage=function(X){X=X||50;var W=H("#profileMediaDetailContainer").is(":visible");if(!W){H("#profileMediaDetailContainer").removeClass("h-hide")}var Y=Math.floor(H("#profileMediaDetailContainer").width()/128);if(!W){H("#profileMediaDetailContainer").addClass("h-hide")}return(X%Y==0||X<=Y)?X:X-(X%Y)};function O(W){H(".profMediaFilterRow").removeClass("filterSelected");H(W.target).addClass("filterSelected");if(H(W.target).hasClass("profMediaFilterAllTypes")){S.mediaTypeFilter=false}else{if(H(W.target).hasClass("profMediaFilterGallery")){S.mediaTypeFilter="gallery"}else{if(H(W.target).hasClass("profMediaFilterVideo")){S.mediaTypeFilter="video"}}}D(1)}function D(W){H("body").css("cursor","wait");var X=H(".js-profile-media-container",P);vBulletin.AJAX({call:"/ajax/render/profile_media_content",data:({userid:X.data("user-id"),pageno:W,perpage:X.data("perpage"),isAjaxTemplateRenderWithData:true,}),success:function(Y){H("#mediacontent").html(Y.template);H("#profileMediaDetailContainer").empty();H("#mediacontent").removeClass("h-hide");J(false);S.currentMediaPage=W;G(H("#mediaList"),S.currentMediaPage);if(!vBulletin.isScrolledIntoView(H("#profileTabs .profile-tabs-nav"))){H("html,body").animate({scrollTop:H("#profileTabs .profile-tabs-nav").offset().top},"slow")}},complete:function(){H("body").css("cursor","auto")},title_phrase:"profile_media",})}function V(Y){var X=this.id;if(H("#profileMediaDetailContainer").is(":visible")){M(Y);return false}if(X=="mediaCurrentPage"){var Z=parseInt(H("#mediaCurrentPage").val());if(Z>0&&Z<=parseInt(H("#mediaPageCount").html())){D(Z);T(Z)}else{H("#mediaCurrentPage").val(S.currentMediaPage)}}else{if(X=="mediaPreviousPage"){if(S.currentMediaPage>1){var W=S.currentMediaPage-1;D(W);T(W)}else{H("#mediaPreviousPage").addClass("h-disabled")}}else{if(X=="mediaNextPage"){if(S.currentMediaPage<parseInt(H("#mediaPageCount").html())){var W=S.currentMediaPage+1;D(W);T(W)}else{H("#mediaNextPage").addClass("h-disabled")}}}}return false}function T(W){var Y=vBulletin.makePaginatedUrl(location.href,W);if(L.isEnabled()){var X={from:"media_filter",page:W||1,tab:P.data("url-path")?P.data("url-path"):"#"+P.attr("id")};L.pushState(X,document.title,Y)}else{if(B){location.href=Y}}}vBulletin.media.setHistoryStateChange=function(){B=P.find(".conversation-toolbar-wrapper").data("allow-history")=="1";L=new vBulletin.history.instance(B);if(L.isEnabled()){L.setStateChange(function(a){var Z=L.getState();if(Z.data.from=="media_filter"){L.log(Z.data,Z.title,Z.url);var W=P.closest(".ui-tabs"),X=W.find(".ui-tabs-nav > li").filter('li:has(a[href*="#{0}"])'.format(P.attr("id")));if(X.hasClass("ui-tabs-active")){D(Z.data.page)}else{var Y=X.index();vBulletin.selectTabByIndex.call(W,Y)}}},"media_filter")}};function M(Y){if(!S.currentNodeId&&!S.currentUserId){return false}var W=Y.target.id;if(W=="mediaCurrentPage"){targetPage=parseInt(H("#mediaCurrentPage").val());if(targetPage>0&&targetPage<=parseInt(H("#mediaPageCount").html())){var X={nodeid:S.currentNodeId,userid:S.currentUserId,pageno:targetPage,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:S.currentDateFilter};F(X)}else{H("#mediaCurrentPage").val(S.currentGalleryPage)}}else{if(W=="mediaPreviousPage"){if(S.currentGalleryPage>1){var X={nodeid:S.currentNodeId,userid:S.currentUserId,pageno:S.currentGalleryPage-1,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:S.currentDateFilter};F(X)}else{H("#mediaPreviousPage ").addClass("h-disabled")}}else{if(W=="mediaNextPage"){if(S.currentGalleryPage<parseInt(H("#mediaPageCount").html())){var X={nodeid:S.currentNodeId,userid:S.currentUserId,pageno:S.currentGalleryPage+1,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:S.currentDateFilter};F(X)}else{H("#mediaNextPage").addClass("h-disabled")}}}}return false}function J(W){H("#profileMediaDetailContainer").toggleClass("h-hide",!W);H("#profileMediaContainer").toggleClass("h-hide",W);H(".media-tab .profile-toolbar .toolset-left > li").toggleClass("h-hide-imp",!W).has(".profile-media-upload, .profile-media-createvideo").toggleClass("h-hide-imp",W);H("#mediaPreviousPage").closest("pagenav-controls").toggleClass("h-hide",W)}function G(X,Y){var W=Number(X.data("totalpages")),Z=H(".media-tab .pagenav-controls-container").toggleClass("h-hide",(W<=1));if(Z.is(":visible")){H("#mediaPreviousPage").toggleClass("h-disabled",(Y<=1));H("#mediaNextPage").toggleClass("h-disabled",(Y>=W));H("#mediaCurrentPage").val(Y);H("#mediaPageCount").text(W)}}function F(a,c,d,b){var Y=H("#profileMediaDetailContainer"),X={nodeid:S.currentNodeId,userid:S.currentUserId,channelid:0,pageno:1,dateFilter:S.currentDateFilter,albumid:0};a=H.extend({},X,a);if(!isNaN(a.nodeid)){H("body").css("cursor","wait");var Z;if(a.nodeid==-1){Z="profile_media_videolist"}else{Z="profile_textphotodetail"}if(Y.closest(".media-tab").length==0){H(".media-tab").append(S.profileMediaDetailContainer)}H("#profileMediaContainer").closest(".tab").find("li.list-item-gallery").remove();var W={nodeid:a.nodeid,userid:a.userid,channelid:a.channelid,pageno:a.pageno,albumid:a.albumid,viewMore:d,isAjaxTemplateRenderWithData:true,};if(a.dateFilter){W.dateFilter=a.dateFilter}if(a.perpage){W.perpage=a.perpage}vBulletin.AJAX({call:"/ajax/render/"+Z,data:W,success:function(e){S.currentNodeId=a.nodeid;S.currentUserId=a.userid;S.currentGalleryPage=a.pageno;if(d){H(".js-album-detail .js-photo-preview").append(e.template);H(".more-gallery",Y).toggleClass("h-hide-imp",(S.currentGalleryPage>=H(".js-album-detail").data("totalpages")))}else{Y.html(e.template);Y.addClass("list-item").attr("data-nodeid",a.nodeid);H(".profile-media-uploadphotos",Y).click(I);J(true);if(a.perpage){H(".media-tab").data("perpage",a.perpage).data("callbacks",b)}}vBulletin.initFlexGridFixLastRowAll();if(a.nodeid==-1){G(H(".media-video-list",Y),S.currentGalleryPage)}H(".profile-toolbar .media-toolbar-filter").removeClass("h-hide");if(b&&typeof b.success=="function"){b.success()}},after_error:function(){if(b&&typeof b.error=="function"){b.error()}},complete:function(){H("body").css("cursor","auto");if(b&&typeof b.complete=="function"){b.complete()}},title_phrase:"profile_media",})}}function I(Y){H(document).data("gallery-container",H(this).closest(".js-album-detail"));var W=vBulletin.upload.getUploadedPhotosDlg(false);var X=W.data("nodeid");if(!X||isNaN(parseInt(X))){return }vBulletin.AJAX({call:"/ajax/render/media_addphotos",data:{nodeid:X,isAjaxTemplateRenderWithData:true,},success:function(Z){W.html(Z.template);vBulletin.upload.initializePhotoUpload(W.parent());var a=W.find(".js-save-button");a.off("click").on("click",A);W.find(".js-cancel-button").off("click").on("click",function(b){W.dialog("close")});vBulletin.upload.relocateLastInRowClass(W.find(".photo-item-wrapper"));if(H(".photo-display .photo-item-wrapper:not(.h-hide)",W).length>0){vBulletin.upload.changeButtonText(H(".b-button--upload .js-upload-label",W),vBulletin.phrase.get("upload_more"));a.show()}else{a.hide()}W.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(W)},after_error:function(){W.dialog("close")},title_phrase:"profile_media",})}function K(X){var W=U(H(this));W.pageno=1;W.perpage=vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE);S.currentDateFilter=H(this).closest(".js-profile-media-container").find(".toolbar-filter-overlay input[name=filter_time]:checked").val();S.currentFilter=W;F(W)}function C(Z){var Y=H(".media-tab").data("perpage");var X=H(".media-tab").data("callbacks");var W=U(H(this));W.pageno=S.currentGalleryPage+1;if(Y){W.perpage=Y}F(W,false,1,X)}function A(Z){var Y=H(Z.target).closest(".profile-media-photoupload-dialog"),W=H(Z.target).closest("form");if(W.length>0){H(Z.target).closest(".photo-display-container").find(".photo-item-wrapper:not(.h-hide)").each(function(a,c){var b=parseInt(H(c).find(".filedataid").val());if(!isNaN(b)){W.append('<input type="hidden" name="filedataid[]" value="'+b+'"/>');H('<input type="hidden" name="title_'+b+'" />').val(H(c).find("textarea").val()).appendTo(W)}});var X=H("button",W).prop("disabled",true);vBulletin.AJAX({url:W.attr("action"),data:W.serializeArray(),success:function(){Y.dialog("close");D(S.currentMediaPage)},complete:function(){X.prop("disabled",false)},title_phrase:"profile_media",})}else{Y.dialog("close")}}function U(W){var Y;if(H("#profileMediaContainer").is(":visible")){Y=H("#profileMediaContainer")}else{if(H("#profileMediaDetailContainer").is(":visible")){Y=H("#profileMediaDetailContainer")}}var X={nodeid:parseInt(W.data("nodeid"),10)||parseInt(Y.attr("data-nodeid"),10),userid:parseInt(Y.data("userid"),10),channelid:parseInt(Y.data("channelid"),10),dateFilter:S.currentDateFilter,albumid:parseInt(W.data("albumid"),10)};if(isNaN(X.channelid)){X.channelid=0}if(isNaN(X.nodeid)){X.nodeid=0}if(X.nodeid>0){X.userid=0}else{if(isNaN(X.userid)){X.userid=0}}if(isNaN(X.albumid)){X.albumid=0}return X}function Q(){H(document).off("click","#mediaList .albumLink").on("click","#mediaList .albumLink",K);var W=false;P.off("click",".profile-media-createvideo, .profile-media-upload").on("click",".profile-media-createvideo, .profile-media-upload",function(Z){var Y=H(this).hasClass("profile-media-upload")?"gallery":"video";if(!W){W=H(Z.target).closest(".ui-widget-content").find(".profileMediaEditContainer").dialog({modal:true,autoOpen:false,width:800,title:vBulletin.phrase.get("profile_media"),resizable:false,closeOnEscape:false,showCloseButton:false,dialogClass:"dialog-container dialog-box edit-media-upload-dialog js-profile-media",close:function(){H(document).data("gallery-container",null)}});vBulletin.ckeditor.initEditor(W.find(".js-ckeditor-init-on-focus"));vBulletin.upload.initializePhotoUpload(W)}W.off("dialogopen").on("dialogopen",function(a,b){W.find('.b-toolbar__item[data-panel="b-content-entry-panel__content--{0}"]:not(.b-toolbar__item--active)'.format(Y)).trigger("click");vBulletin.ckeditor.initEditorComponents(W);H(document).data("gallery-container",H(this).find(".b-content-entry-panel__content--"+Y))}).dialog("open")});P.off("click","#profileMediaDetailContainer .more-gallery").on("click","#profileMediaDetailContainer .more-gallery",C);P.off("click",".profile-media-backbtn").on("click",".profile-media-backbtn",function(Y){S.currentDateFilter=H(this).closest(".conversation-toolbar-wrapper").find(".toolbar-filter-overlay input[name=filter_time]:checked").val();H(".profile-toolbar .media-toolbar-filter").addClass("h-hide");J(false);H(this).closest(".conversation-toolbar-wrapper").find(".filtered-by").addClass("h-hide").find(".filter-text-wrapper").empty();G(H("#mediaList"),S.currentMediaPage)});P.off("change","#mediaCurrentPage").on("change","#mediaCurrentPage",V);P.off("click","#mediaPreviousPage, #mediaNextPage").on("click","#mediaPreviousPage, #mediaNextPage",V);S.profileMediaDetailContainer=H("#profileMediaDetailContainer").clone();var X=".js-album-detail .js-post__content-wrapper .js-content-entry form";H(document).off("afterSave",X).on("afterSave",X,function(Z,Y){F(S.currentFilter);return false});H(document).off("afterCancel",X).on("afterCancel",X,function(Y){H(Y.currentTarget).closest(".js-album-detail").find(".conversation-body, .profile-media-uploadphotos, .js-photo-preview").removeClass("h-hide-imp");return true});H(document).off("afterSave",".js-profile-media .js-content-entry form").on("afterSave",".js-profile-media  .js-content-entry form",function(b,a){var d=H(".b-toolbar__item--active",this).data("panel");if(d=="b-content-entry-panel__content--gallery"){var Y=H("#mediaList"),c=Number(Y.data("totalpages")),f=Number(Y.data("totalcount")),Z=(f%vBulletin.media.ALBUMS_PERPAGE)==0?c+1:c;if(a.alert){vBulletin.alert("media",a.alert,"alert")}D(Z)}else{D(1)}return false});if(P.length){vBulletin.media.setHistoryStateChange();E=P.closest(".canvas-widget").find(".js-module-top-anchor").attr("id");P.off("click",".media-toolbar-filter").on("click",".media-toolbar-filter",function(Y){H(".filter-wrapper",this).toggleClass("selected");H(".arrow .vb-icon",this).toggleClass("vb-icon-triangle-down-wide vb-icon-triangle-up-wide");H(Y.target).closest(".conversation-toolbar-wrapper").find(".toolbar-filter-overlay").slideToggle("slow",function(){var Z="media_filter";if(H(this).is(":visible")){H("body").off("click."+Z).on("click."+Z,function(c){if(H(c.target).closest(".toolbar-filter-overlay").length==0&&H(c.target).closest(".toolbar-filter").length==0){H("body").off("click."+Z);H(".media-toolbar-filter").trigger("click")}});var b={};var a=vBulletin.isScrolledIntoView(this,b);if(!a){H("html,body").animate({scrollTop:"+="+Math.abs(b.bottom)},"fast")}}else{H("body").off("click."+Z)}})});H("form.media-filter-overlay",P).trigger("reset");P.off("change",".media-filter-overlay input[type=radio]").on("change",".media-filter-overlay input[type=radio]",function(g,d){var Z;if(!L.isEnabled()&&B){Z=vBulletin.makePaginatedUrl(location.href,1);location.href=vBulletin.makeFilterUrl(Z,this.name,this.value,c,E);return true}S.currentDateFilter=this.value;var a=U(H(g.target));var c=H(".media-tab");if(c.data("perpage")){a.perpage=c.data("perpage")}F(a,true,0,c.data("callbacks"));if(!H(this).data("bypass-filter-display")){vBulletin.conversation.displaySelectedFilterText(this,this.value)}if(L.isEnabled()&&!d){var f=vBulletin.getSelectedFilters(H("form.toolbar-filter-overlay",c)),j=this.name,Y=this.value,i=H(".conversation-toolbar-wrapper .filtered-by",c),b=c.data("url-path")?c.data("url-path"):"#"+c.attr("id"),h={from:"filter",page:1,tab:b,filters:f,filtervalue:Y,filtername:j};if(!i.data("reset")){Z=vBulletin.makePaginatedUrl(location.href,1);Z=vBulletin.makeFilterUrl(Z,j,Y,c)}else{Z=location.pathname.replace(/\/page[0-9]+/,"")}L.pushState(h,document.title,Z);i.data("reset",null)}});P.off("click",".filtered-by .x").on("click",".filtered-by .x",function(a){var Y=H(this).closest(".filtered-by"),c=H(this).closest(".filter-text"),Z=c.data("filter-name");if(!L.isEnabled()&&B){location.href=vBulletin.makeFilterUrl(location.href,Z,c.data("filter-value"),P,E);return false}$defaultSelectedFilter=H(".toolbar-filter-overlay .filter-options input[name={0}]".format(Z),P).prop("checked",false).filter(".js-default-checked");c.remove();var b=Y.find(".filter-text").length;if(b==0){Y.addClass("h-hide");Y.data("reset",true)}else{if(b==1){Y.find(".clear-all").addClass("h-hide")}}if($defaultSelectedFilter.length==1){$defaultSelectedFilter.data("bypass-filter-display",true);$defaultSelectedFilter.trigger("click");$defaultSelectedFilter.data("bypass-filter-display",null)}})}vBulletin.initFlexGridFixLastRowAll()}function R(){H(document).ready(Q);vBulletin.media.loadGalleryById=F}R()})(jQuery);