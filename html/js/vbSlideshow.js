/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["gallery_slideshow","no_photos_found_or_post_deleted"]);(function(E){window.vBulletin=window.vBulletin||{};vBulletin.gallery=vBulletin.gallery||{};var K=5,N=E("#slideshow-dialog"),D=false,R=false,P=0,I={},B="fast",G="swing";function C(U,V,Y,T){var a=U.find(".caption"),X;a.html("").hide();if(V.links){a.append(E("<div />").addClass("links ellipsis").html(V.links))}if(V.title){a.append(E("<div />").addClass("title ellipsis").html(V.title))}if(V.links&&V.title){X=15}else{if(V.links||V.title){X=35}else{X=50}}var W=U.find(".slideshow-wrapper .jcarousel-item-"+Y+" img");var Z=W.outerWidth();a.css({marginBottom:X+"px",width:"100%",textAlign:"center",marginLeft:"auto",marginRight:"auto"});W.one("load",function(){var b=E(this).outerWidth();a.css("width",b+"px")});if(T){a.fadeIn("fast",function(){U.click()})}else{a.show()}}function L(U){var T=vBulletin.isRtl();if(U.which==37){vBulletin.gallery.slideshow.jcarousel(T?"next":"prev")}else{if(U.which==39){vBulletin.gallery.slideshow.jcarousel(T?"prev":"next")}}if(U.which>=33&&U.which<=40){return false}}function M(T){var U=T.originalEvent.wheelDelta||-T.originalEvent.detail;if(U>0){vBulletin.gallery.slideshow.jcarousel("prev")}else{vBulletin.gallery.slideshow.jcarousel("next")}return false}function A(U){if(U){var T=vBulletin.isRtl(),W=0,V=false,Z=false;function Y(b,c){var g=E(".slideshow-wrapper .jcarousel-list"),n=T?"right":"left",o=parseInt(g.css(n),10);if(b==="restore"){var m=o+(W*-1);if(c){var q={};q[n]=m;g.animate(q,B,G)}else{g.css(n,m)}W=0;V=false}else{if(b==="prev"||b==="next"){var p=parseInt(g.css("width"),10),l=g.find(".jcarousel-item"),a=l.length,e=l.first(),k=parseInt(e.css("width"),10),j=(a-1)*k,h=Math.abs(V),f,i,d;f=(b==="prev")?(h-k):(h+k);i=(f>=0&&f<=j);d=(!f?0:(f/k))+1;f=(f*-1);if(i){var q={};q[n]=f;g.animate(q,B,G,function(){W=0;if(V!==false){g.css("visibility","hidden");g.css(n,V);V=false;vBulletin.gallery.slideshow.jcarousel("scroll",d,false);g.css("visibility","visible")}});if(V!==false){return true}}}else{if(T){b=b*-1}g.css(n,o+b);W+=b;if(V===false){V=o}}}}function X(b){Z=true;var a=Y(b,true);if(!a){Y("restore",true)}}E(document).swipeable({swipeleft:function(b,a){X(T?"prev":"next")},swiperight:function(b,a){X(T?"next":"prev")},swiping:function(b,a){Y(a.moved.x)},swipeend:function(b,a){if(W&&!Z){Y("restore",true)}if(Z){Z=false}},})}else{E(document).swipeable("disable")}}function J(){var j=E(this);R=this;if(j.closest("#preview-overlay").length==1){return false}var Y=j.attr("data-channelid"),k=j.attr("src");if(typeof (k)==="undefined"){k=j.attr("href")}if(D===false){D=j.index()}E(document).off("click","#slideshow-dialog .close-btn").on("click","#slideshow-dialog .close-btn",function(){N.dialog("close")});E(document).off("click",".thumbnails .image-wrapper").on("click",".thumbnails .image-wrapper",function(s,r){if(typeof r=="undefined"){r=true}E(".thumbnails .image-wrapper",N).addClass("dimmed");E(this).removeClass("dimmed");var q=Number(E(this).parent().attr("jcarouselindex"));N.data("thumbclick",true);vBulletin.gallery.slideshow.jcarousel("scroll",q,r);N.removeData("thumbclick")});E("body").css("overflow","hidden");var p=E(window).innerWidth(),b=E(window).innerHeight(),h=false;var U=h?20:0,m=10,g=parseInt(p-(U*2),10),V=parseInt(b-(U*2),10);if(!h){N.css({borderRadius:0,borderWidth:0})}else{N.css({borderRadius:"",borderWidth:""})}var a=parseInt(g-(m*2),10),i=parseInt(V-(m*2),10),X=60,Z=90,f=50,n=a-10,d=parseInt(i-X-f-(m*3),10),e=parseInt(((d/2)-21),10);P=n;K=Math.max(1,Math.floor(P/Z));N.dialog({autoOpen:false,resizable:false,closeOnEscape:true,showTitleBar:false,modal:true,width:g,height:V,dialogClass:"slideshow-dialog",open:function(){E(".ui-widget-overlay").bind("click",function(){N.dialog("close")});E(document).off("keydown",L).on("keydown",L);E(document).off("mousewheel DOMMouseScroll",M).on("mousewheel DOMMouseScroll",M);A(true)},close:function(r,q){if(vBulletin.gallery.thumbnails){vBulletin.gallery.thumbnails.jcarousel("destroy")}if(vBulletin.gallery.slideshow){vBulletin.gallery.slideshow.jcarousel("destroy")}E("body").css("overflow","auto");E(document).off("keydown",L);E(document).off("mousewheel DOMMouseScroll",M);A(false);R=false;D=false}});var T=N.find(".slideshow-wrapper .slideshow-list");if(T.length==0){T=N.find(".slideshow-wrapper").append(E("<ul />").addClass("slideshow-list"))}N.dialog("open");window.vBulletin.loadingIndicator.show();var c=j.closest(".js-slideshow__gallery-node").attr("data-node-id")||j.closest(".js-slideshow__gallery-node").attr("data-nodeid")||j.closest(".js-post-sm").attr("data-nodeid");var l="\nwidth: "+n+"px;\nheight: "+d+"px;\n",W=".slideshow .slideshow-wrapper",o='<style type="text/css">\n'+W+" > .jcarousel-clip-horizontal {"+l+"}\n.slideshow .thumbnails > .jcarousel-clip-horizontal {\nwidth: "+P+"px;\n}\n"+W+" > .jcarousel-clip .jcarousel-item {"+l+"}\n.slideshow .jcarousel-item .image {\nmax-width: "+n+"px;\nmax-height: "+d+"px;\n}\n"+W+" > .jcarousel-prev-horizontal,\n"+W+" > .jcarousel-next-horizontal {\ntop: "+e+"px;\n}\n</style>";E(o).appendTo("head");vBulletin.gallery.slideshow=T.jcarousel({wrap:null,animation:B,easing:G,scroll:1,rtl:vBulletin.isRtl(),initCallback:function(z,t){if(t=="init"){var r=j.closest(".b-content-entry-panel__content--gallery").find(".js-photo-postdata input");if(r.length>0){var q={photos:[]};r.filter('[name="filedataid[]"]').each(function(){var AA={title:JShtmlEncode(r.filter('[name="title_'+this.value+'"]').val()),url:pageData.baseurl+"/filedata/fetch?filedataid="+this.value,thumb:pageData.baseurl+"/filedata/fetch?thumb=1&filedataid="+this.value};q.photos.push(AA)});setTimeout(function(){S(q,z)},10)}else{var v={nodeid:c};if(vBulletin.media&&vBulletin.media.MEDIA_USERID){v.userid=vBulletin.media.MEDIA_USERID}if(Y){v.channelid=Y}var s=parseInt(E(".albumSlideShowPageNo").val());if(!isNaN(s)){v.pageno=s}var w=parseInt(E(".albumSlideShowPerPage").val());if(!isNaN(w)){v.perpage=w}var u=E(".media-tab .media-filter-overlay .filter-options input:checked").val();if(u){v.dateFilter=u}if(!isNaN(D)){v.startIndex=D}var y=v;if(c>0){y.startIndex=""}var x=JSON.stringify(y);if(I[x]){S(I[x],z)}else{E.post(vBulletin.getAjaxBaseurl()+"/filedata/gallery",v,function(AA){if(!AA&&k){AA={photos:[{title:"",url:k,thumb:""}]}}I[x]=AA;S(AA,z)},"json").complete(function(){window.vBulletin.loadingIndicator.hide()})}}}},itemVisibleInCallback:{onBeforeAnimation:function(v,t,s,u){if(u=="init"){return false}var x=N.data("image-data");if(x){var q=x.photos.length;if(s>0){while(s>q){s-=q}}else{while(s<=0){s+=q}}C(N,x.photos[s-1],s,true);var w=Math.floor(K/2);var r=s-w;r=Math.max(r,1);vBulletin.gallery.thumbnails.jcarousel("scroll",r,true);if(!N.data("thumbclick")){E("#slideshow-dialog .thumbnails .image-wrapper").addClass("dimmed");vBulletin.gallery.thumbnails.jcarousel("get",s).find(".image-wrapper").removeClass("dimmed")}D=s-1}}}});return false}function S(a,Z){if(!a||!a.photos){openAlertDialog({title:vBulletin.phrase.get("gallery_slideshow"),message:vBulletin.phrase.get("no_photos_found_or_post_deleted"),iconType:"warning"});return }N.data("image-data",a);Q(Z,a,N);N.find(".slideshow-wrapper").find(".jcarousel-prev-horizontal").addClass("b-icon b-icon__arrow-block-left").end().find(".jcarousel-next-horizontal").addClass("b-icon b-icon__arrow-block-right");var V=N.find(".thumbnails"),U=V.find(".jcarousel-prev-horizontal"),T=V.find(".jcarousel-next-horizontal");U.addClass("b-icon b-icon__arrow-bar-left").toggleClass("b-icon--disabled",U.is(".jcarousel-prev-disabled"));T.addClass("b-icon b-icon__arrow-bar-right").toggleClass("b-icon--disabled",T.is(".jcarousel-next-disabled"));C(N,a.photos[0],1);if(a.photos.length>1){vBulletin.gallery.thumbnails.jcarousel("get",1).find(".image-wrapper").removeClass("dimmed")}var X=D;var W=parseInt(E(".albumSlideShowPerPage").val());if(!isNaN(W)){X=D%W}if(X>0){var Y=vBulletin.gallery.slideshow.jcarousel("scroll",X+1,false);if(typeof Y!="undefined"){N.find(".slideshow-wrapper").css("visibility","hidden");window.setTimeout(function(){E(".thumbnails .image-wrapper",N).eq(X).trigger("click",[false]);N.find(".slideshow-wrapper").css("visibility","")},0)}}window.vBulletin.loadingIndicator.hide()}function Q(U,W,T){U.size(W.photos.length);if(W.photos.length>1){E("#slideshow-dialog .thumbnails").show();H(W)}else{E("#slideshow-dialog .thumbnails").hide();T.dialog("option","height","auto")}var V=U.first||1;E.each(W.photos,function(Y,X){U.add(V+Y,'<div class="image-wrapper"><a href="{0}"><img src="{0}" alt="{1}" class="image" /></a></div>'.format(X.url,X.htmltitle))})}function H(V){var U=E("#slideshow-dialog .thumbnails .thumbnail-list");if(U.length==0){U=E("#slideshow-dialog .thumbnails").append(E("<ul />").addClass("thumbnail-list"))}function T(Y){var X=E(Y.buttonPrev[0]),W=E(Y.buttonNext[0]);X.toggleClass("b-icon--disabled",X.is(".jcarousel-prev-disabled"));W.toggleClass("b-icon--disabled",W.is(".jcarousel-next-disabled"))}vBulletin.gallery.thumbnails=U.jcarousel({wrap:null,animation:"fast",easing:"swing",scroll:K,rtl:vBulletin.isRtl(),size:V.photos.length,initCallback:function(a,Y){if(Y=="init"){a.size(V.photos.length);E.each(V.photos,function(d,c){var b=(a.first||1)+d;if(a.has(b)){return true}if(b>V.photos.length){return false}var e=E("<img />").addClass("thumbnail").on("load",function(){}).attr({src:c.thumb,alt:""}).appendTo(E("<div />").addClass("image-wrapper dimmed"));a.add(b,e.parent().get(0))});var W=E("#slideshow-dialog .thumbnails .jcarousel-clip");var Z=Math.min(a.size(),K)*90;var X=Math.min(P,Z);W.css("width",X+"px");if(a.size()<=K){a.buttonNext.hide();a.buttonPrev.hide()}}},itemVisibleInCallback:{onBeforeAnimation:function(Z,X,W,Y){E("#slideshow-dialog .thumbnails").data("visible-range",{first:Z.first,last:Z.last})}},buttonNextCallback:T,buttonPrevCallback:T}).disableSelection()}function F(){if(R){var U=R;var T=D;N.dialog("close");D=T;J.call(U)}}function O(){E(document).off("click",".b-gallery-thumbnail-list__item").on("click",".b-gallery-thumbnail-list__item",J);N.addClass("js-no-responsive-resize");E(window).on("resize",E.debounce(300,F))}E(document).ready(O)})(jQuery);