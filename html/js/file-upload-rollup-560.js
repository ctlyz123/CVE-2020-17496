// ***************************
// js.compressed/jquery/jquery.tmpl.min.js
// ***************************
(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],"tmplItem")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw"Template command not found: "+j;h=i._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=k(b);e=e?","+k(e)+")":c?")":"";f=c?b.indexOf(".")>-1?b+c:"("+b+").call($item"+e:b;g=c?f:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else g=f=h.$1||"null";d=k(d);return"');"+i[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(d,c,b,a){a=a?","+a+")":b?")":"";return a?"("+c+").call($item"+a:d}):h.$2||"")+"_.push('"})+"');}return _;")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,"tmplItem");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);

// ***************************
// js.compressed/blueimp/jquery.fileupload.min.js
// ***************************
(function(A){if(typeof define==="function"&&define.amd){define(["jquery","jquery-ui/ui/widget"],A)}else{if(typeof exports==="object"){A(require("jquery"),require("./vendor/jquery.ui.widget"))}else{A(window.jQuery)}}}(function(B){B.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||B('<input type="file"/>').prop("disabled"));B.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);B.support.xhrFormDataFileUpload=!!window.FormData;B.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function A(C){var D=C==="dragover";return function(F){F.dataTransfer=F.originalEvent&&F.originalEvent.dataTransfer;var E=F.dataTransfer;if(E&&B.inArray("Files",E.types)!==-1&&this._trigger(C,B.Event(C,{delegatedEvent:F}))!==false){F.preventDefault();if(D){E.dropEffect="copy"}}}}B.widget("blueimp.fileupload",{options:{dropZone:B(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(D,C){D=this.messages[D]||D.toString();if(C){B.each(C,function(E,F){D=D.replace("{"+E+"}",F)})}return D},formData:function(C){return C.serializeArray()},add:function(D,C){if(D.isDefaultPrevented()){return false}if(C.autoUpload||(C.autoUpload!==false&&B(this).fileupload("option","autoUpload"))){C.process().done(function(){C.submit()})}},processData:false,contentType:false,cache:false,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:B.support.blobSlice&&function(){var C=this.slice||this.webkitSlice||this.mozSlice;return C.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=((Date.now)?Date.now():(new Date()).getTime());this.loaded=0;this.bitrate=0;this.getBitrate=function(E,D,C){var F=E-this.timestamp;if(!this.bitrate||!C||F>C){this.bitrate=(D-this.loaded)*(1000/F)*8;this.loaded=D;this.timestamp=E}return this.bitrate}},_isXHRUpload:function(C){return !C.forceIframeTransport&&((!C.multipart&&B.support.xhrFileUpload)||B.support.xhrFormDataFileUpload)},_getFormData:function(C){var D;if(B.type(C.formData)==="function"){return C.formData(C.form)}if(B.isArray(C.formData)){return C.formData}if(B.type(C.formData)==="object"){D=[];B.each(C.formData,function(E,F){D.push({name:E,value:F})});return D}return[]},_getTotal:function(D){var C=0;B.each(D,function(E,F){C+=F.size||1});return C},_initProgressObject:function(D){var C={loaded:0,total:0,bitrate:0};if(D._progress){B.extend(D._progress,C)}else{D._progress=C}},_initResponseObject:function(C){var D;if(C._response){for(D in C._response){if(C._response.hasOwnProperty(D)){delete C._response[D]}}}else{C._response={}}},_onProgress:function(F,E){if(F.lengthComputable){var D=((Date.now)?Date.now():(new Date()).getTime()),C;if(E._time&&E.progressInterval&&(D-E._time<E.progressInterval)&&F.loaded!==F.total){return }E._time=D;C=Math.floor(F.loaded/F.total*(E.chunkSize||E._progress.total))+(E.uploadedBytes||0);this._progress.loaded+=(C-E._progress.loaded);this._progress.bitrate=this._bitrateTimer.getBitrate(D,this._progress.loaded,E.bitrateInterval);E._progress.loaded=E.loaded=C;E._progress.bitrate=E.bitrate=E._bitrateTimer.getBitrate(D,C,E.bitrateInterval);this._trigger("progress",B.Event("progress",{delegatedEvent:F}),E);this._trigger("progressall",B.Event("progressall",{delegatedEvent:F}),this._progress)}},_initProgressListener:function(C){var D=this,E=C.xhr?C.xhr():B.ajaxSettings.xhr();if(E.upload){B(E.upload).bind("progress",function(F){var G=F.originalEvent;F.lengthComputable=G.lengthComputable;F.loaded=G.loaded;F.total=G.total;D._onProgress(F,C)});C.xhr=function(){return E}}},_deinitProgressListener:function(C){var D=C.xhr?C.xhr():B.ajaxSettings.xhr();if(D.upload){B(D.upload).unbind("progress")}},_isInstanceOf:function(C,D){return Object.prototype.toString.call(D)==="[object "+C+"]"},_initXHRData:function(D){var F=this,H,E=D.files[0],C=D.multipart||!B.support.xhrFileUpload,G=B.type(D.paramName)==="array"?D.paramName[0]:D.paramName;D.headers=B.extend({},D.headers);if(D.contentRange){D.headers["Content-Range"]=D.contentRange}if(!C||D.blob||!this._isInstanceOf("File",E)){D.headers["Content-Disposition"]='attachment; filename="'+encodeURI(E.uploadName||E.name)+'"'}if(!C){D.contentType=E.type||"application/octet-stream";D.data=D.blob||E}else{if(B.support.xhrFormDataFileUpload){if(D.postMessage){H=this._getFormData(D);if(D.blob){H.push({name:G,value:D.blob})}else{B.each(D.files,function(I,J){H.push({name:(B.type(D.paramName)==="array"&&D.paramName[I])||G,value:J})})}}else{if(F._isInstanceOf("FormData",D.formData)){H=D.formData}else{H=new FormData();B.each(this._getFormData(D),function(I,J){H.append(J.name,J.value)})}if(D.blob){H.append(G,D.blob,E.uploadName||E.name)}else{B.each(D.files,function(I,J){if(F._isInstanceOf("File",J)||F._isInstanceOf("Blob",J)){H.append((B.type(D.paramName)==="array"&&D.paramName[I])||G,J,J.uploadName||J.name)}})}}D.data=H}}D.blob=null},_initIframeSettings:function(C){var D=B("<a></a>").prop("href",C.url).prop("host");C.dataType="iframe "+(C.dataType||"");C.formData=this._getFormData(C);if(C.redirect&&D&&D!==location.host){C.formData.push({name:C.redirectParamName||"redirect",value:C.redirect})}},_initDataSettings:function(C){if(this._isXHRUpload(C)){if(!this._chunkedUpload(C,true)){if(!C.data){this._initXHRData(C)}this._initProgressListener(C)}if(C.postMessage){C.dataType="postmessage "+(C.dataType||"")}}else{this._initIframeSettings(C)}},_getParamName:function(C){var D=B(C.fileInput),E=C.paramName;if(!E){E=[];D.each(function(){var F=B(this),G=F.prop("name")||"files[]",H=(F.prop("files")||[1]).length;while(H){E.push(G);H-=1}});if(!E.length){E=[D.prop("name")||"files[]"]}}else{if(!B.isArray(E)){E=[E]}}return E},_initFormSettings:function(C){if(!C.form||!C.form.length){C.form=B(C.fileInput.prop("form"));if(!C.form.length){C.form=B(this.options.fileInput.prop("form"))}}C.paramName=this._getParamName(C);if(!C.url){C.url=C.form.prop("action")||location.href}C.type=(C.type||(B.type(C.form.prop("method"))==="string"&&C.form.prop("method"))||"").toUpperCase();if(C.type!=="POST"&&C.type!=="PUT"&&C.type!=="PATCH"){C.type="POST"}if(!C.formAcceptCharset){C.formAcceptCharset=C.form.attr("accept-charset")}},_getAJAXSettings:function(D){var C=B.extend({},this.options,D);this._initFormSettings(C);this._initDataSettings(C);return C},_getDeferredState:function(C){if(C.state){return C.state()}if(C.isResolved()){return"resolved"}if(C.isRejected()){return"rejected"}return"pending"},_enhancePromise:function(C){C.success=C.done;C.error=C.fail;C.complete=C.always;return C},_getXHRPromise:function(F,E,D){var C=B.Deferred(),G=C.promise();E=E||this.options.context||G;if(F===true){C.resolveWith(E,D)}else{if(F===false){C.rejectWith(E,D)}}G.abort=C.promise;return this._enhancePromise(G)},_addConvenienceMethods:function(F,E){var D=this,C=function(G){return B.Deferred().resolveWith(D,G).promise()};E.process=function(H,G){if(H||G){E._processQueue=this._processQueue=(this._processQueue||C([this])).then(function(){if(E.errorThrown){return B.Deferred().rejectWith(D,[E]).promise()}return C(arguments)}).then(H,G)}return this._processQueue||C([this])};E.submit=function(){if(this.state()!=="pending"){E.jqXHR=this.jqXHR=(D._trigger("submit",B.Event("submit",{delegatedEvent:F}),this)!==false)&&D._onSend(F,this)}return this.jqXHR||D._getXHRPromise()};E.abort=function(){if(this.jqXHR){return this.jqXHR.abort()}this.errorThrown="abort";D._trigger("fail",null,this);return D._getXHRPromise(false)};E.state=function(){if(this.jqXHR){return D._getDeferredState(this.jqXHR)}if(this._processQueue){return D._getDeferredState(this._processQueue)}};E.processing=function(){return !this.jqXHR&&this._processQueue&&D._getDeferredState(this._processQueue)==="pending"};E.progress=function(){return this._progress};E.response=function(){return this._response}},_getUploadedBytes:function(E){var C=E.getResponseHeader("Range"),F=C&&C.split("-"),D=F&&F.length>1&&parseInt(F[1],10);return D&&D+1},_chunkedUpload:function(N,H){N.uploadedBytes=N.uploadedBytes||0;var G=this,E=N.files[0],F=E.size,C=N.uploadedBytes,D=N.maxChunkSize||F,J=this._blobSlice,K=B.Deferred(),M=K.promise(),I,L;if(!(this._isXHRUpload(N)&&J&&(C||(B.type(D)==="function"?D(N):D)<F))||N.data){return false}if(H){return true}if(C>=F){E.error=N.i18n("uploadedBytes");return this._getXHRPromise(false,N.context,[null,"error",E.error])}L=function(){var P=B.extend({},N),O=P._progress.loaded;P.blob=J.call(E,C,C+(B.type(D)==="function"?D(P):D),E.type);P.chunkSize=P.blob.size;P.contentRange="bytes "+C+"-"+(C+P.chunkSize-1)+"/"+F;G._trigger("chunkbeforesend",null,P);G._initXHRData(P);G._initProgressListener(P);I=((G._trigger("chunksend",null,P)!==false&&B.ajax(P))||G._getXHRPromise(false,P.context)).done(function(Q,S,R){C=G._getUploadedBytes(R)||(C+P.chunkSize);if(O+P.chunkSize-P._progress.loaded){G._onProgress(B.Event("progress",{lengthComputable:true,loaded:C-P.uploadedBytes,total:C-P.uploadedBytes}),P)}N.uploadedBytes=P.uploadedBytes=C;P.result=Q;P.textStatus=S;P.jqXHR=R;G._trigger("chunkdone",null,P);G._trigger("chunkalways",null,P);if(C<F){L()}else{K.resolveWith(P.context,[Q,S,R])}}).fail(function(Q,S,R){P.jqXHR=Q;P.textStatus=S;P.errorThrown=R;G._trigger("chunkfail",null,P);G._trigger("chunkalways",null,P);K.rejectWith(P.context,[Q,S,R])}).always(function(){G._deinitProgressListener(P)})};this._enhancePromise(M);M.abort=function(){return I.abort()};L();return M},_beforeSend:function(D,C){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer();this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(C);this._initProgressObject(C);C._progress.loaded=C.loaded=C.uploadedBytes||0;C._progress.total=C.total=this._getTotal(C.files)||1;C._progress.bitrate=C.bitrate=0;this._active+=1;this._progress.loaded+=C.loaded;this._progress.total+=C.total},_onDone:function(C,H,G,E){var F=E._progress.total,D=E._response;if(E._progress.loaded<F){this._onProgress(B.Event("progress",{lengthComputable:true,loaded:F,total:F}),E)}D.result=E.result=C;D.textStatus=E.textStatus=H;D.jqXHR=E.jqXHR=G;this._trigger("done",null,E)},_onFail:function(E,G,F,D){var C=D._response;if(D.recalculateProgress){this._progress.loaded-=D._progress.loaded;this._progress.total-=D._progress.total}C.jqXHR=D.jqXHR=E;C.textStatus=D.textStatus=G;C.errorThrown=D.errorThrown=F;this._trigger("fail",null,D)},_onAlways:function(E,F,D,C){this._trigger("always",null,C)},_onSend:function(H,F){if(!F.submit){this._addConvenienceMethods(H,F)}var G=this,J,C,I,D,K=G._getAJAXSettings(F),E=function(){G._sending+=1;K._bitrateTimer=new G._BitrateTimer();J=J||(((C||G._trigger("send",B.Event("send",{delegatedEvent:H}),K)===false)&&G._getXHRPromise(false,K.context,C))||G._chunkedUpload(K)||B.ajax(K)).done(function(L,N,M){G._onDone(L,N,M,K)}).fail(function(L,N,M){G._onFail(L,N,M,K)}).always(function(N,O,M){G._deinitProgressListener(K);G._onAlways(N,O,M,K);G._sending-=1;G._active-=1;if(K.limitConcurrentUploads&&K.limitConcurrentUploads>G._sending){var L=G._slots.shift();while(L){if(G._getDeferredState(L)==="pending"){L.resolve();break}L=G._slots.shift()}}if(G._active===0){G._trigger("stop")}});return J};this._beforeSend(H,K);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){I=B.Deferred();this._slots.push(I);D=I.then(E)}else{this._sequence=this._sequence.then(E,E);D=this._sequence}D.abort=function(){C=[undefined,"abort","abort"];if(!J){if(I){I.rejectWith(K.context,C)}return E()}return J.abort()};return this._enhancePromise(D)}return E()},_onAdd:function(N,J){var M=this,S=true,R=B.extend({},this.options,J),E=J.files,P=E.length,F=R.limitMultiFileUploads,H=R.limitMultiFileUploadSize,Q=R.limitMultiFileUploadSizeOverhead,L=0,K=this._getParamName(R),D,C,O,I,G=0;if(!P){return false}if(H&&E[0].size===undefined){H=undefined}if(!(R.singleFileUploads||F||H)||!this._isXHRUpload(R)){O=[E];D=[K]}else{if(!(R.singleFileUploads||H)&&F){O=[];D=[];for(I=0;I<P;I+=F){O.push(E.slice(I,I+F));C=K.slice(I,I+F);if(!C.length){C=K}D.push(C)}}else{if(!R.singleFileUploads&&H){O=[];D=[];for(I=0;I<P;I=I+1){L+=E[I].size+Q;if(I+1===P||((L+E[I+1].size+Q)>H)||(F&&I+1-G>=F)){O.push(E.slice(G,I+1));C=K.slice(G,I+1);if(!C.length){C=K}D.push(C);G=I+1;L=0}}}else{D=K}}}J.originalFiles=E;B.each(O||E,function(T,U){var V=B.extend({},J);V.files=O?U:[U];V.paramName=D[T];M._initResponseObject(V);M._initProgressObject(V);M._addConvenienceMethods(N,V);S=M._trigger("add",B.Event("add",{delegatedEvent:N}),V);return S});return S},_replaceFileInput:function(F){var C=F.fileInput,D=C.clone(true),E=C.is(document.activeElement);F.fileInputClone=D;B("<form></form>").append(D)[0].reset();C.after(D).detach();if(E){D.focus()}B.cleanData(C.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(G,H){if(H===C[0]){return D[0]}return H});if(C[0]===this.element[0]){this.element=D}},_handleFileTreeEntry:function(H,J){var E=this,I=B.Deferred(),C=[],K,D=function(L){if(L&&!L.entry){L.entry=H}I.resolve([L])},G=function(L){E._handleFileTreeEntries(L,J+H.name+"/").done(function(M){I.resolve(M)}).fail(D)},F=function(){K.readEntries(function(L){if(!L.length){G(C)}else{C=C.concat(L);F()}},D)};J=J||"";if(H.isFile){if(H._file){H._file.relativePath=J;I.resolve(H._file)}else{H.file(function(L){L.relativePath=J;I.resolve(L)},D)}}else{if(H.isDirectory){K=H.createReader();F()}else{I.resolve([])}}return I.promise()},_handleFileTreeEntries:function(C,E){var D=this;return B.when.apply(B,B.map(C,function(F){return D._handleFileTreeEntry(F,E)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(D){D=D||{};var C=D.items;if(C&&C.length&&(C[0].webkitGetAsEntry||C[0].getAsEntry)){return this._handleFileTreeEntries(B.map(C,function(F){var E;if(F.webkitGetAsEntry){E=F.webkitGetAsEntry();if(E){E._file=F.getAsFile()}return E}return F.getAsEntry()}))}return B.Deferred().resolve(B.makeArray(D.files)).promise()},_getSingleFileInputFiles:function(E){E=B(E);var C=E.prop("webkitEntries")||E.prop("entries"),D,F;if(C&&C.length){return this._handleFileTreeEntries(C)}D=B.makeArray(E.prop("files"));if(!D.length){F=E.prop("value");if(!F){return B.Deferred().resolve([]).promise()}D=[{name:F.replace(/^.*\\/,"")}]}else{if(D[0].name===undefined&&D[0].fileName){B.each(D,function(G,H){H.name=H.fileName;H.size=H.fileSize})}}return B.Deferred().resolve(D).promise()},_getFileInputFiles:function(C){if(!(C instanceof B)||C.length===1){return this._getSingleFileInputFiles(C)}return B.when.apply(B,B.map(C,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(E){var C=this,D={fileInput:B(E.target),form:B(E.target.form)};this._getFileInputFiles(D.fileInput).always(function(F){D.files=F;if(C.options.replaceFileInput){C._replaceFileInput(D)}if(C._trigger("change",B.Event("change",{delegatedEvent:E}),D)!==false){C._onAdd(E,D)}})},_onPaste:function(E){var C=E.originalEvent&&E.originalEvent.clipboardData&&E.originalEvent.clipboardData.items,D={files:[]};if(C&&C.length){B.each(C,function(F,H){var G=H.getAsFile&&H.getAsFile();if(G){D.files.push(G)}});if(this._trigger("paste",B.Event("paste",{delegatedEvent:E}),D)!==false){this._onAdd(E,D)}}},_onDrop:function(F){F.dataTransfer=F.originalEvent&&F.originalEvent.dataTransfer;var C=this,E=F.dataTransfer,D={};if(E&&E.files&&E.files.length){F.preventDefault();this._getDroppedFiles(E).always(function(G){D.files=G;if(C._trigger("drop",B.Event("drop",{delegatedEvent:F}),D)!==false){C._onAdd(F,D)}})}},_onDragOver:A("dragover"),_onDragEnter:A("dragenter"),_onDragLeave:A("dragleave"),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste})}if(B.support.fileInput){this._on(this.options.fileInput,{change:this._onChange})}},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(C,D){var E=B.inArray(C,this._specialOptions)!==-1;if(E){this._destroyEventHandlers()}this._super(C,D);if(E){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var C=this.options;if(C.fileInput===undefined){C.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]')}else{if(!(C.fileInput instanceof B)){C.fileInput=B(C.fileInput)}}if(!(C.dropZone instanceof B)){C.dropZone=B(C.dropZone)}if(!(C.pasteZone instanceof B)){C.pasteZone=B(C.pasteZone)}},_getRegExp:function(E){var D=E.split("/"),C=D.pop();D.shift();return new RegExp(D.join("/"),C)},_isRegExpOption:function(C,D){return C!=="url"&&B.type(D)==="string"&&/^\/.*\/[igm]{0,3}$/.test(D)},_initDataAttributes:function(){var D=this,C=this.options,E=this.element.data();B.each(this.element[0].attributes,function(G,F){var H=F.name.toLowerCase(),I;if(/^data-/.test(H)){H=H.slice(5).replace(/-[a-z]/g,function(J){return J.charAt(1).toUpperCase()});I=E[H];if(D._isRegExpOption(H,I)){I=D._getRegExp(I)}C[H]=I}})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(D){var C=this;if(!D||this.options.disabled){return }if(D.fileInput&&!D.files){this._getFileInputFiles(D.fileInput).always(function(E){D.files=E;C._onAdd(null,D)})}else{D.files=B.makeArray(D.files);this._onAdd(null,D)}},send:function(G){if(G&&!this.options.disabled){if(G.fileInput&&!G.files){var E=this,C=B.Deferred(),H=C.promise(),D,F;H.abort=function(){F=true;if(D){return D.abort()}C.reject(null,"abort","abort");return H};this._getFileInputFiles(G.fileInput).always(function(I){if(F){return }if(!I.length){C.reject();return }G.files=I;D=E._onSend(null,G);D.then(function(J,L,K){C.resolve(J,L,K)},function(J,L,K){C.reject(J,L,K)})});return this._enhancePromise(H)}G.files=B.makeArray(G.files);if(G.files.length){return this._onSend(null,G)}}return this._getXHRPromise(false,G&&G.context)}})}));;

// ***************************
// js.compressed/fileupload.js
// ***************************
/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["add_caption","attach_files","click_to_add_caption","drop_files_here_to_upload","enter_url_file","error_uploading_image","invalid_image_allowed_filetypes_are","remove_all_photos_confirmation_message","remove_all_photos_q","upload","upload_more","uploading","you_are_already_editing_continue","you_must_be_logged_in_to_upload_photos"]);(function(I){window.vBulletin=window.vBulletin||{};vBulletin.upload=vBulletin.upload||{};vBulletin.gallery=vBulletin.gallery||{};vBulletin.permissions=vBulletin.permissions||{};var F=3,A=2,N=[],O=0;vBulletin.upload.changeButtonText=function(R,S){if(!R.data("default-text")){R.data("default-text",R.text())}R.text(S)};vBulletin.upload.restoreButtonText=function(R){if(R.data("default-text")){R.text(R.data("default-text"))}};vBulletin.upload.initializePhotoUpload=function(T){console.log("Fileupload: vBulletin.upload.initializePhotoUpload");if(!T||T.length==0){T=I("body");if(I(".js-photo-display",T).length>1){console.log("Fileupload: multiple upload forms, abort");return false}}I(".js-continue-button",T).off("click").on("click",function(Y){console.log("Fileupload: continue");var W=I(document).data("gallery-container"),V=W.find(".js-photo-postdata"),X={},U=I(this).closest(".js-photo-display"),Z=[];V.empty();U.find(".photo-item-wrapper:not(.h-hide)").each(function(){var c=I(this).find(".filedataid"),b=c.val(),e=c.data("nodeid"),d=I.trim(I(this).find(".caption-box").val());I(this).removeClass("tmp-photo");if(typeof e!=="undefined"){I(this).removeClass("tmp-photo");var a=I.inArray(e,N);if(a==-1){N.push(e)}}V.append(I("<input />").attr({type:"hidden",name:"filedataid[]"}).val(b)).append(I("<input />").attr({type:"hidden",name:"title_"+b}).val(d));Z.push({filedataid:b,title:d})});X.photocount=Z.length;X.photos=Z;U.find(".photo-item-wrapper:hidden").remove();U.dialog("close");if(X.photos.length>0){vBulletin.AJAX({call:"/ajax/render/editor_gallery_photoblock",data:X,type:"POST",dataType:"json",success:function(a){var b=I(a);b.find(".b-gallery-thumbnail-list__aside").addClass("h-invisible");W.find(".js-gallery-content").removeClass("h-hide").find(".js-panel-content").empty().append(b);setTimeout(function(){b.find(".b-gallery-thumbnail-list__aside").removeClass("h-invisible")},500);vBulletin.upload.initializePhotoUpload(W);I(document).data("gallery-container",null)},error:vBulletin.ajaxtools.logAjaxError,api_error:vBulletin.ajaxtools.logApiError});I(".js-edit-photos",W).removeClass("h-hide");vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",W),vBulletin.phrase.get("upload_more"))}else{I(".js-panel-content",W).empty();I(".js-edit-photos",W).addClass("h-hide");vBulletin.upload.restoreButtonText(I(".b-button--upload .js-upload-label",W))}});I(".js-edit-photos",T).off("click").on("click",function(V){console.log("Fileupload: edit photos");I(document).data("gallery-container",I(this).closest(".b-content-entry-panel__content--gallery"));var U=vBulletin.upload.getUploadedPhotosDlg(false);vBulletin.upload.relocateLastInRowClass(U.find(".photo-item-wrapper"));S(U);U.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(U);I(".b-button--upload",U).trigger("focus")});I(".js-cancel-button",T).off("click").on("click",function(W){console.log("Fileupload: cancel");var U=I(this).closest(".js-photo-display"),V=I(document).data("gallery-container");I(".photo-item-wrapper.tmp-photo",U).remove();I(".photo-item-wrapper",U).removeClass("h-hide");if(I(".js-panel-content",V).length>0){vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",V),vBulletin.phrase.get("upload_more"))}else{vBulletin.upload.restoreButtonText(I(".b-button--upload .js-upload-label",V))}U.dialog("close")});function S(U){vBulletin.upload.updateButtons(U,(I(".photo-display .photo-item-wrapper:not(.h-hide)",U).length>0))}I(".b-content-entry-panel__content--gallery, .js-profile-media-photoupload-dialog",T).fileupload({dropZone:"vb-self",dataType:"json",url:vBulletin.getAjaxBaseurl()+"/uploader/upload-photo",type:"POST",formData:function(V){console.log("Fileupload: gallery formData");var U=V.find(".b-content-entry-panel__content--gallery");if(U.length==0){U=I("<form>")}if(U.find('input[name="securitytoken"]').length){U.find('input[name="securitytoken"]').val(pageData.securitytoken)}else{U.append('<input type="hidden" name="securitytoken" value="'+pageData.securitytoken+'" />')}return U.find(":input").filter(function(){return !I(this).parent().hasClass("js-photo-postdata")}).serializeArray()},acceptFileTypes:/(gif|jpg|jpeg|jpe|png)$/i,add:function(X,W){console.log("Fileupload: gallery add");var V=I(this);I(document).data("gallery-container",V);var U=vBulletin.upload.getUploadedPhotosDlg(true);I(".js-upload-progress",U).removeClass("h-hide");vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",U),vBulletin.phrase.get("uploading"));W.submit();I(".b-button--upload",U).trigger("focus")},done:function(a,Z){console.log("Fileupload: gallery done");var X=I(this),c=(Z&&Z.result&&Z.result.errors&&(Z.result.errors.length>0)),b;I(document).data("gallery-container",X);var W=vBulletin.upload.getUploadedPhotosDlg(false);if(Z&&Z.result&&!c&&Z.result.edit){var U=I(Z.result.edit),Y=I(".photo-display",W),V=W.parent(),d=I(".photo-item-wrapper:not(.h-hide)",Y).length;U.addClass("tmp-photo");if((d+1)%F==0){U.addClass("last-in-row")}if((d+1)>vBulletin.contentEntryBox.ATTACHLIMIT){I(".js-attach-limit-warning",W).show()}vBulletin.upload.adjustPhotoDialogForScrollbar(W);Y.append(U);U.fadeIn("fast",function(){W.dialog("option","position",{of:window});if(V.hasClass("has-scrollbar")){Y.animate({scrollTop:Y[0].scrollHeight-Y.height()},"fast")}});I(".js-continue-button, .btnPhotoUploadSave",W).show();return }else{if(c){b=Z.result.errors[0][0]||Z.result.errors[0][1];switch(b){case"please_login_first":b="you_must_be_logged_in_to_upload_photos";break;default:b=Z.result.errors[0];break}}else{b="unknown_error"}}S(W);vBulletin.warning("upload",b)},fail:function(Y,X){console.log("Fileupload: gallery fail");var V="error_uploading_image",U="error";if(X&&X.files.length>0){switch(X.files[0].error){case"acceptFileTypes":V="invalid_image_allowed_filetypes_are";U="warning";break}}var W=vBulletin.upload.getUploadedPhotosDlg(false);S(W);vBulletin.alert("upload",V)},always:function(W,V){console.log("Fileupload: gallery always");var U=vBulletin.upload.getUploadedPhotosDlg(false);U.find(".js-upload-progress").addClass("h-hide");S(U)}});I(".b-content-entry-panel__content--attachment",T).off("click",".js-upload-from-url").on("click",".js-upload-from-url",function(V){var U=I(this);$promtDlg=openPromptDialog({title:vBulletin.phrase.get("enter_url_file"),message:"",buttonLabel:{okLabel:vBulletin.phrase.get("ok"),cancelLabel:vBulletin.phrase.get("cancel")},onClickOK:function(X){var W=U.parent().find(".js-upload-progress");W.removeClass("h-hide");vBulletin.AJAX({call:"/uploader/url",data:{urlupload:X,attachment:1,uploadFrom:I(".js-uploadFrom",T).val()},skipdefaultsuccess:true,complete:function(){W.addClass("h-hide")},success:function(Y){if(Y.imageUrl){$panel=I(".b-content-entry-panel__content--attachment");Y.name=Y.filename;R.call($panel,Y)}},title_phrase:"error_uploading_image"})}});return false});I(".b-content-entry-panel__content--attachment",T).fileupload({dropZone:"vb-self",dataType:"json",url:vBulletin.getAjaxBaseurl()+"/uploader/upload",type:"POST",previewAsCanvas:false,autoUpload:true,formData:function(V){console.log("Fileupload: attachments formData");var U=V.find(".b-content-entry-panel__content--attachment");if(U.length==0){U=I("<form>")}if(U.find('input[name="securitytoken"]').length){U.find('input[name="securitytoken"]').val(pageData.securitytoken)}else{U.append('<input type="hidden" name="securitytoken" value="'+pageData.securitytoken+'" />')}return U.find(":input").filter(function(){return !I(this).parent().hasClass("js-attach-postdata")}).serializeArray()},add:function(V,U){console.log("Fileupload: attachments add");T.find(".js-upload-progress").removeClass("h-hide");U.submit()},done:function(Y,X){console.log("Fileupload: attachments done");var V=vBulletin.phrase.get("error_uploading_image");var U="error";var Z=[];var W=this;if(X&&X.result){if(X.result.error){Z.push(vBulletin.phrase.get(X.result.error))}else{I.each(X.result,function(a,b){if(!b.error){R.call(W,b);return }else{if(b.error[0]=="please_login_first"){Z.push(vBulletin.phrase.get("you_must_be_logged_in_to_upload_photos"));return false}else{Z.push(b.name);I.each(b.error,function(d,c){Z.push(vBulletin.phrase.get(c))})}}})}}else{Z.push(vBulletin.phrase.get("unknown_error"))}if(Z.length>0){openAlertDialog({title:vBulletin.phrase.get("upload"),message:Z.join("<br />\n"),iconType:"warning"})}},fail:function(X,W){console.log("Fileupload: attachments fail");var V=vBulletin.phrase.get("error_uploading_image");var U="error";if(W&&W.files.length>0){switch(W.files[0].error){case"acceptFileTypes":V=vBulletin.phrase.get("invalid_image_allowed_filetypes_are");U="warning";break}}openAlertDialog({title:vBulletin.phrase.get("upload"),message:V,iconType:U})},always:function(V,U){T.find(".js-upload-progress").addClass("h-hide")}});function R(V){console.log("Fileupload: attachDone");var c=(this instanceof I)?this:I(this),Y=c.find(".js-attach-list"),X=I(".js-uploadFrom").val();if(!V.name){openAlertDialog({title:vBulletin.phrase.get("upload"),message:vBulletin.phrase.get("unknown_error"),iconType:"warning"})}var W,U,Z=false;if(V.name.match(/\.(gif|jpg|jpeg|jpe|png|bmp)$/i)){U=I("<img />").attr("src",pageData.baseurl+"/filedata/fetch?type=thumb&filedataid="+V.filedataid).addClass("b-attach-item__image");Z=true}else{U=I("<span />").addClass("b-icon b-icon__doc--gray h-margin-bottom-m")}var a=Y.find(".js-attach-item-sample").first().clone(true);if(X=="signature"){Y.find(".js-attach-item").not(".js-attach-item-sample").remove();Z=false;I('[data-action="insert"]',a).data("action","insert_sigpic").attr("data-action","insert_sigpic")}a.removeClass("js-attach-item-sample");a.find(".js-attach-item-image").append(U);a.find(".js-attach-item-filename").text(V.name);a.append(I("<input />").attr({type:"hidden",name:"filedataids[]"}).val(V.filedataid)).append(I("<input />").attr({type:"hidden",name:"filenames[]"}).val(V.name));var b="";if(W=V.name.match(/\.([a-z]+)$/i)){b=W[1]}a.data("fileext",b);a.data("filename",V.name);a.data("filedataid",V.filedataid);a.data("attachnodeid",0);if(!Z){a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert_image"||I(this).data("action")=="insert_label"}).addClass("h-hide");a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert"}).html(vBulletin.phrase.get("insert"))}if(!vBulletin.ckeditor.checkEnvironment()){a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert"||I(this).data("action")=="insert_image"||I(this).data("action")=="insert_label"}).addClass("h-hide")}a.appendTo(Y).removeClass("h-hide");Y.removeClass("h-hide")}I(".gallery-submit-form",T).submit(function(){I(".js-photo-display .photo-display input",I(this).closest(".gallery-editor")).appendTo(I(this));var U=I("input[type=hidden][name=ret]",this);if(I.trim(U.val())==""){U.val(location.href)}});I(document).off("click.photoadd",".js-photo-selector-continue").on("click.photoadd",".js-photo-selector-continue",function(){console.log("Fileupload: continue 2");var U=I(this).closest(".js-photo-selector-container"),V={};U.find(".photo-item-wrapper").each(function(){var W=I(this).find(".filedataid"),Z=W.data("nodeid");if(W.is(":checked")){var X=W.val(),Y=I.trim(I(this).find(".photo-title").text());V[Z]={imgUrl:vBulletin.getAjaxBaseurl()+"/filedata/fetch?filedataid="+X+"&thumb=1",filedataid:X,title:Y}}});if(!I.isEmptyObject(V)){vBulletin.AJAX({call:"/ajax/render/photo_item",data:{items:V,wrapperClass:"tmp-photo"},success:function(X){var Y=vBulletin.upload.getUploadedPhotosDlg(false),Z=I(".photo-display",Y),W;Z.append(X);W=I(".photo-item-wrapper:not(.h-hide)",Z);vBulletin.upload.relocateLastInRowClass(W);vBulletin.upload.updateButtons(Y,(W.length>0));vBulletin.upload.adjustPhotoDialogForScrollbar(Y);Y.dialog("option","position",{of:window});Y.dialog("open")}})}I(".photo-selector-galleries",U).tabs("destroy");U.dialog("close")});I(".js-photo-selector-cancel",T).off("click").on("click",function(){console.log("Fileupload: cancel 2");I(document).data("gallery-container",null);var U=I(this).closest(".js-photo-selector-container");I(".photo-selector-galleries",U).tabs("destroy");U.dialog("close")});console.log("Fileupload: vBulletin.upload.initializePhotoUpload finished")};vBulletin.upload.getUploadedPhotosDlg=function(R,T){var S;if(!T||T.length==0){T=I(document).data("gallery-container");if(!T){return I()}}if(T.hasClass("profile-media-photoupload-dialog")){S=T;if(R){S.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(S)}return S}S=T.find(".js-photo-display");if(S.length==0){I(".js-photo-display").each(function(){if(I(this).data("associated-editor")==T.get(0)){S=I(this);return false}})}else{S.dialog({modal:true,width:606,autoOpen:false,showCloseButton:false,closeOnEscape:false,resizable:false,showTitleBar:false,dialogClass:"dialog-container upload-photo-dialog-container dialog-box"});S.data("orig-width",S.dialog("option","width"));S.data("associated-editor",T.get(0));S.find(".b-form-input__file--hidden").prop("disabled",false)}if(R){S.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(S)}return S};vBulletin.upload.adjustPhotoDialogForScrollbar=function(U){var V=I(".photo-display",U);var T=U.parent();var S=I(".photo-item-wrapper:not(.h-hide)",V).length;if(!T.hasClass("has-scrollbar")&&S>=(F*A)){var R=window.vBulletin.getScrollbarWidth();T.addClass("has-scrollbar");U.dialog("option","width",U.dialog("option","width")+R+11)}};vBulletin.upload.relocateLastInRowClass=function(R){R.removeClass("last-in-row").filter(":not(.h-hide)").filter(function(S){return((S%F)==(F-1))}).addClass("last-in-row")};vBulletin.upload.updateButtons=function(U,S){var R=I(".b-button--upload .js-upload-label",U),T=I(".js-continue-button, .btnPhotoUploadSave",U);if(S){vBulletin.upload.changeButtonText(R,vBulletin.phrase.get("upload_more"))}else{vBulletin.upload.restoreButtonText(R)}T.toggle(S)};function L(){I(document).off("click.removephoto",".photo-display .photo-item .remove-icon").on("click.removephoto",".photo-display .photo-item .remove-icon",function(){var S=I(this).closest(".photo-item-wrapper"),W=I(".filedataid",S).data("nodeid"),V=S.parents(".js-photo-display").last();if(typeof W!=="undefined"){var U=I.inArray(W,N);if(U!=-1){N.splice(U,1)}}S.addClass("h-hide");var R=V.find(".photo-item-wrapper:not(.h-hide)"),T=R.length;if(T<=vBulletin.contentEntryBox.ATTACHLIMIT){I(".js-attach-limit-warning",V).hide()}vBulletin.upload.relocateLastInRowClass(R);if(R.length<=(F*A)){V.parent().removeClass("has-scrollbar");V.dialog("option","width",V.data("orig-width"))}vBulletin.upload.updateButtons(V,(R.length>0))});I(document).off("blur.photocaption",".photo-display .photo-caption .caption-box").on("blur.photocaption",".photo-display .photo-caption .caption-box",function(){I(this).scrollTop(0)});vBulletin.conversation.bindEditFormEventHandlers("gallery")}function E(R){I(this).replaceWith(R)}function H(){var R=jQuery.fn.fileupload;jQuery.fn.fileupload=function(){if(arguments&&arguments[0]&&arguments[0].dropZone&&arguments[0].dropZone=="vb-self"){arguments[0].dropZone=I(this)}if(arguments&&arguments[0]&&arguments[0].dropZone){arguments[0].dropZone.addClass("js-fileupload-dropzone")}var S=R.apply(this,arguments);return S}}function G(){if("FormData" in window&&"FileReader" in window){var R=document.createElement("div");if("draggable" in R||("ondragstart" in R&&"ondrop" in R)){return true}}return false}function B(S){if(S.data("vb-dropzone-overlay-initialized")){return }var R=I("<div />").html(vBulletin.phrase.get("drop_files_here_to_upload")).addClass("h-hide-imp js-fileupload-dropzone-overlay fileupload-dropzone-overlay").appendTo(S);S.css("position","relative").data("vb-dropzone-overlay-initialized","1")}function D(){I(".cke_contents").each(function(){var S=I(this),R=S.find(".js-fileupload-dropzone-ckeditor-overlay");if(!R.length){var R=I("<div />").addClass("h-hide-imp js-fileupload-dropzone-ckeditor-overlay fileupload-dropzone-ckeditor-overlay").appendTo(S)}})}function P(R){if(!R){I(".js-fileupload-dropzone-overlay").addClass("h-hide-imp");I(".js-fileupload-dropzone-ckeditor-overlay").addClass("h-hide-imp")}else{R.each(function(){var S=I(this);B(S);D();S.find(".js-fileupload-dropzone-overlay").removeClass("h-hide-imp");I(".js-fileupload-dropzone-ckeditor-overlay").removeClass("h-hide-imp")})}}function C(U){var R=I(".js-fileupload-dropzone"),T=R.filter(":visible"),S=R.filter(".b-content-entry-panel__content--attachment");U.preventDefault();if(R.length<1){return }if(T.length==0&&S.length==1){I(".js-content-entry").find(".js-toolbar-secondary .b-toolbar__item").filter(function(){return(I(this).data("panel")=="b-content-entry-panel__content--attachment")}).click();T=R.filter(":visible")}if(T.length>0){P(T);U.originalEvent.dataTransfer.dropEffect="none";U.originalEvent.dataTransfer.effectAllowed="none";I(".js-fileupload-dropzone-overlay").removeClass("fileupload-dropzone-overlay--active");I(U.target).parents().each(function(){var V=I(this);if(V.is(".js-fileupload-dropzone")){V.find(".js-fileupload-dropzone-overlay").addClass("fileupload-dropzone-overlay--active");U.originalEvent.dataTransfer.dropEffect="copy";U.originalEvent.dataTransfer.effectAllowed="copy";return false}})}}function K(R){R.preventDefault();P(false)}function M(){if(O){window.clearTimeout(O);O=0}}function Q(S){var R=this;O=window.setTimeout(function(){K.call(R,S)},200)}function J(){if(G()){I(document).off("dragover",C).on("dragover",C);I(document).off("drop dragend",K).on("drop dragend",K);I(document).off("dragenter dragover",M).on("dragenter dragover",M);I(document).off("dragleave",Q).on("dragleave",Q)}}I(document).ready(function(){H();J();vBulletin.upload.initializePhotoUpload();L()})})(jQuery);;

