/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["add_caption","attach_files","click_to_add_caption","drop_files_here_to_upload","enter_url_file","error_uploading_image","invalid_image_allowed_filetypes_are","remove_all_photos_confirmation_message","remove_all_photos_q","upload","upload_more","uploading","you_are_already_editing_continue","you_must_be_logged_in_to_upload_photos"]);(function(I){window.vBulletin=window.vBulletin||{};vBulletin.upload=vBulletin.upload||{};vBulletin.gallery=vBulletin.gallery||{};vBulletin.permissions=vBulletin.permissions||{};var F=3,A=2,N=[],O=0;vBulletin.upload.changeButtonText=function(R,S){if(!R.data("default-text")){R.data("default-text",R.text())}R.text(S)};vBulletin.upload.restoreButtonText=function(R){if(R.data("default-text")){R.text(R.data("default-text"))}};vBulletin.upload.initializePhotoUpload=function(T){console.log("Fileupload: vBulletin.upload.initializePhotoUpload");if(!T||T.length==0){T=I("body");if(I(".js-photo-display",T).length>1){console.log("Fileupload: multiple upload forms, abort");return false}}I(".js-continue-button",T).off("click").on("click",function(Y){console.log("Fileupload: continue");var W=I(document).data("gallery-container"),V=W.find(".js-photo-postdata"),X={},U=I(this).closest(".js-photo-display"),Z=[];V.empty();U.find(".photo-item-wrapper:not(.h-hide)").each(function(){var c=I(this).find(".filedataid"),b=c.val(),e=c.data("nodeid"),d=I.trim(I(this).find(".caption-box").val());I(this).removeClass("tmp-photo");if(typeof e!=="undefined"){I(this).removeClass("tmp-photo");var a=I.inArray(e,N);if(a==-1){N.push(e)}}V.append(I("<input />").attr({type:"hidden",name:"filedataid[]"}).val(b)).append(I("<input />").attr({type:"hidden",name:"title_"+b}).val(d));Z.push({filedataid:b,title:d})});X.photocount=Z.length;X.photos=Z;U.find(".photo-item-wrapper:hidden").remove();U.dialog("close");if(X.photos.length>0){vBulletin.AJAX({call:"/ajax/render/editor_gallery_photoblock",data:X,type:"POST",dataType:"json",success:function(a){var b=I(a);b.find(".b-gallery-thumbnail-list__aside").addClass("h-invisible");W.find(".js-gallery-content").removeClass("h-hide").find(".js-panel-content").empty().append(b);setTimeout(function(){b.find(".b-gallery-thumbnail-list__aside").removeClass("h-invisible")},500);vBulletin.upload.initializePhotoUpload(W);I(document).data("gallery-container",null)},error:vBulletin.ajaxtools.logAjaxError,api_error:vBulletin.ajaxtools.logApiError});I(".js-edit-photos",W).removeClass("h-hide");vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",W),vBulletin.phrase.get("upload_more"))}else{I(".js-panel-content",W).empty();I(".js-edit-photos",W).addClass("h-hide");vBulletin.upload.restoreButtonText(I(".b-button--upload .js-upload-label",W))}});I(".js-edit-photos",T).off("click").on("click",function(V){console.log("Fileupload: edit photos");I(document).data("gallery-container",I(this).closest(".b-content-entry-panel__content--gallery"));var U=vBulletin.upload.getUploadedPhotosDlg(false);vBulletin.upload.relocateLastInRowClass(U.find(".photo-item-wrapper"));S(U);U.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(U);I(".b-button--upload",U).trigger("focus")});I(".js-cancel-button",T).off("click").on("click",function(W){console.log("Fileupload: cancel");var U=I(this).closest(".js-photo-display"),V=I(document).data("gallery-container");I(".photo-item-wrapper.tmp-photo",U).remove();I(".photo-item-wrapper",U).removeClass("h-hide");if(I(".js-panel-content",V).length>0){vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",V),vBulletin.phrase.get("upload_more"))}else{vBulletin.upload.restoreButtonText(I(".b-button--upload .js-upload-label",V))}U.dialog("close")});function S(U){vBulletin.upload.updateButtons(U,(I(".photo-display .photo-item-wrapper:not(.h-hide)",U).length>0))}I(".b-content-entry-panel__content--gallery, .js-profile-media-photoupload-dialog",T).fileupload({dropZone:"vb-self",dataType:"json",url:vBulletin.getAjaxBaseurl()+"/uploader/upload-photo",type:"POST",formData:function(V){console.log("Fileupload: gallery formData");var U=V.find(".b-content-entry-panel__content--gallery");if(U.length==0){U=I("<form>")}if(U.find('input[name="securitytoken"]').length){U.find('input[name="securitytoken"]').val(pageData.securitytoken)}else{U.append('<input type="hidden" name="securitytoken" value="'+pageData.securitytoken+'" />')}return U.find(":input").filter(function(){return !I(this).parent().hasClass("js-photo-postdata")}).serializeArray()},acceptFileTypes:/(gif|jpg|jpeg|jpe|png)$/i,add:function(X,W){console.log("Fileupload: gallery add");var V=I(this);I(document).data("gallery-container",V);var U=vBulletin.upload.getUploadedPhotosDlg(true);I(".js-upload-progress",U).removeClass("h-hide");vBulletin.upload.changeButtonText(I(".b-button--upload .js-upload-label",U),vBulletin.phrase.get("uploading"));W.submit();I(".b-button--upload",U).trigger("focus")},done:function(a,Z){console.log("Fileupload: gallery done");var X=I(this),c=(Z&&Z.result&&Z.result.errors&&(Z.result.errors.length>0)),b;I(document).data("gallery-container",X);var W=vBulletin.upload.getUploadedPhotosDlg(false);if(Z&&Z.result&&!c&&Z.result.edit){var U=I(Z.result.edit),Y=I(".photo-display",W),V=W.parent(),d=I(".photo-item-wrapper:not(.h-hide)",Y).length;U.addClass("tmp-photo");if((d+1)%F==0){U.addClass("last-in-row")}if((d+1)>vBulletin.contentEntryBox.ATTACHLIMIT){I(".js-attach-limit-warning",W).show()}vBulletin.upload.adjustPhotoDialogForScrollbar(W);Y.append(U);U.fadeIn("fast",function(){W.dialog("option","position",{of:window});if(V.hasClass("has-scrollbar")){Y.animate({scrollTop:Y[0].scrollHeight-Y.height()},"fast")}});I(".js-continue-button, .btnPhotoUploadSave",W).show();return }else{if(c){b=Z.result.errors[0][0]||Z.result.errors[0][1];switch(b){case"please_login_first":b="you_must_be_logged_in_to_upload_photos";break;default:b=Z.result.errors[0];break}}else{b="unknown_error"}}S(W);vBulletin.warning("upload",b)},fail:function(Y,X){console.log("Fileupload: gallery fail");var V="error_uploading_image",U="error";if(X&&X.files.length>0){switch(X.files[0].error){case"acceptFileTypes":V="invalid_image_allowed_filetypes_are";U="warning";break}}var W=vBulletin.upload.getUploadedPhotosDlg(false);S(W);vBulletin.alert("upload",V)},always:function(W,V){console.log("Fileupload: gallery always");var U=vBulletin.upload.getUploadedPhotosDlg(false);U.find(".js-upload-progress").addClass("h-hide");S(U)}});I(".b-content-entry-panel__content--attachment",T).off("click",".js-upload-from-url").on("click",".js-upload-from-url",function(V){var U=I(this);$promtDlg=openPromptDialog({title:vBulletin.phrase.get("enter_url_file"),message:"",buttonLabel:{okLabel:vBulletin.phrase.get("ok"),cancelLabel:vBulletin.phrase.get("cancel")},onClickOK:function(X){var W=U.parent().find(".js-upload-progress");W.removeClass("h-hide");vBulletin.AJAX({call:"/uploader/url",data:{urlupload:X,attachment:1,uploadFrom:I(".js-uploadFrom",T).val()},skipdefaultsuccess:true,complete:function(){W.addClass("h-hide")},success:function(Y){if(Y.imageUrl){$panel=I(".b-content-entry-panel__content--attachment");Y.name=Y.filename;R.call($panel,Y)}},title_phrase:"error_uploading_image"})}});return false});I(".b-content-entry-panel__content--attachment",T).fileupload({dropZone:"vb-self",dataType:"json",url:vBulletin.getAjaxBaseurl()+"/uploader/upload",type:"POST",previewAsCanvas:false,autoUpload:true,formData:function(V){console.log("Fileupload: attachments formData");var U=V.find(".b-content-entry-panel__content--attachment");if(U.length==0){U=I("<form>")}if(U.find('input[name="securitytoken"]').length){U.find('input[name="securitytoken"]').val(pageData.securitytoken)}else{U.append('<input type="hidden" name="securitytoken" value="'+pageData.securitytoken+'" />')}return U.find(":input").filter(function(){return !I(this).parent().hasClass("js-attach-postdata")}).serializeArray()},add:function(V,U){console.log("Fileupload: attachments add");T.find(".js-upload-progress").removeClass("h-hide");U.submit()},done:function(Y,X){console.log("Fileupload: attachments done");var V=vBulletin.phrase.get("error_uploading_image");var U="error";var Z=[];var W=this;if(X&&X.result){if(X.result.error){Z.push(vBulletin.phrase.get(X.result.error))}else{I.each(X.result,function(a,b){if(!b.error){R.call(W,b);return }else{if(b.error[0]=="please_login_first"){Z.push(vBulletin.phrase.get("you_must_be_logged_in_to_upload_photos"));return false}else{Z.push(b.name);I.each(b.error,function(d,c){Z.push(vBulletin.phrase.get(c))})}}})}}else{Z.push(vBulletin.phrase.get("unknown_error"))}if(Z.length>0){openAlertDialog({title:vBulletin.phrase.get("upload"),message:Z.join("<br />\n"),iconType:"warning"})}},fail:function(X,W){console.log("Fileupload: attachments fail");var V=vBulletin.phrase.get("error_uploading_image");var U="error";if(W&&W.files.length>0){switch(W.files[0].error){case"acceptFileTypes":V=vBulletin.phrase.get("invalid_image_allowed_filetypes_are");U="warning";break}}openAlertDialog({title:vBulletin.phrase.get("upload"),message:V,iconType:U})},always:function(V,U){T.find(".js-upload-progress").addClass("h-hide")}});function R(V){console.log("Fileupload: attachDone");var c=(this instanceof I)?this:I(this),Y=c.find(".js-attach-list"),X=I(".js-uploadFrom").val();if(!V.name){openAlertDialog({title:vBulletin.phrase.get("upload"),message:vBulletin.phrase.get("unknown_error"),iconType:"warning"})}var W,U,Z=false;if(V.name.match(/\.(gif|jpg|jpeg|jpe|png|bmp)$/i)){U=I("<img />").attr("src",pageData.baseurl+"/filedata/fetch?type=thumb&filedataid="+V.filedataid).addClass("b-attach-item__image");Z=true}else{U=I("<span />").addClass("b-icon b-icon__doc--gray h-margin-bottom-m")}var a=Y.find(".js-attach-item-sample").first().clone(true);if(X=="signature"){Y.find(".js-attach-item").not(".js-attach-item-sample").remove();Z=false;I('[data-action="insert"]',a).data("action","insert_sigpic").attr("data-action","insert_sigpic")}a.removeClass("js-attach-item-sample");a.find(".js-attach-item-image").append(U);a.find(".js-attach-item-filename").text(V.name);a.append(I("<input />").attr({type:"hidden",name:"filedataids[]"}).val(V.filedataid)).append(I("<input />").attr({type:"hidden",name:"filenames[]"}).val(V.name));var b="";if(W=V.name.match(/\.([a-z]+)$/i)){b=W[1]}a.data("fileext",b);a.data("filename",V.name);a.data("filedataid",V.filedataid);a.data("attachnodeid",0);if(!Z){a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert_image"||I(this).data("action")=="insert_label"}).addClass("h-hide");a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert"}).html(vBulletin.phrase.get("insert"))}if(!vBulletin.ckeditor.checkEnvironment()){a.find(".js-attach-ctrl").filter(function(){return I(this).data("action")=="insert"||I(this).data("action")=="insert_image"||I(this).data("action")=="insert_label"}).addClass("h-hide")}a.appendTo(Y).removeClass("h-hide");Y.removeClass("h-hide")}I(".gallery-submit-form",T).submit(function(){I(".js-photo-display .photo-display input",I(this).closest(".gallery-editor")).appendTo(I(this));var U=I("input[type=hidden][name=ret]",this);if(I.trim(U.val())==""){U.val(location.href)}});I(document).off("click.photoadd",".js-photo-selector-continue").on("click.photoadd",".js-photo-selector-continue",function(){console.log("Fileupload: continue 2");var U=I(this).closest(".js-photo-selector-container"),V={};U.find(".photo-item-wrapper").each(function(){var W=I(this).find(".filedataid"),Z=W.data("nodeid");if(W.is(":checked")){var X=W.val(),Y=I.trim(I(this).find(".photo-title").text());V[Z]={imgUrl:vBulletin.getAjaxBaseurl()+"/filedata/fetch?filedataid="+X+"&thumb=1",filedataid:X,title:Y}}});if(!I.isEmptyObject(V)){vBulletin.AJAX({call:"/ajax/render/photo_item",data:{items:V,wrapperClass:"tmp-photo"},success:function(X){var Y=vBulletin.upload.getUploadedPhotosDlg(false),Z=I(".photo-display",Y),W;Z.append(X);W=I(".photo-item-wrapper:not(.h-hide)",Z);vBulletin.upload.relocateLastInRowClass(W);vBulletin.upload.updateButtons(Y,(W.length>0));vBulletin.upload.adjustPhotoDialogForScrollbar(Y);Y.dialog("option","position",{of:window});Y.dialog("open")}})}I(".photo-selector-galleries",U).tabs("destroy");U.dialog("close")});I(".js-photo-selector-cancel",T).off("click").on("click",function(){console.log("Fileupload: cancel 2");I(document).data("gallery-container",null);var U=I(this).closest(".js-photo-selector-container");I(".photo-selector-galleries",U).tabs("destroy");U.dialog("close")});console.log("Fileupload: vBulletin.upload.initializePhotoUpload finished")};vBulletin.upload.getUploadedPhotosDlg=function(R,T){var S;if(!T||T.length==0){T=I(document).data("gallery-container");if(!T){return I()}}if(T.hasClass("profile-media-photoupload-dialog")){S=T;if(R){S.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(S)}return S}S=T.find(".js-photo-display");if(S.length==0){I(".js-photo-display").each(function(){if(I(this).data("associated-editor")==T.get(0)){S=I(this);return false}})}else{S.dialog({modal:true,width:606,autoOpen:false,showCloseButton:false,closeOnEscape:false,resizable:false,showTitleBar:false,dialogClass:"dialog-container upload-photo-dialog-container dialog-box"});S.data("orig-width",S.dialog("option","width"));S.data("associated-editor",T.get(0));S.find(".b-form-input__file--hidden").prop("disabled",false)}if(R){S.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(S)}return S};vBulletin.upload.adjustPhotoDialogForScrollbar=function(U){var V=I(".photo-display",U);var T=U.parent();var S=I(".photo-item-wrapper:not(.h-hide)",V).length;if(!T.hasClass("has-scrollbar")&&S>=(F*A)){var R=window.vBulletin.getScrollbarWidth();T.addClass("has-scrollbar");U.dialog("option","width",U.dialog("option","width")+R+11)}};vBulletin.upload.relocateLastInRowClass=function(R){R.removeClass("last-in-row").filter(":not(.h-hide)").filter(function(S){return((S%F)==(F-1))}).addClass("last-in-row")};vBulletin.upload.updateButtons=function(U,S){var R=I(".b-button--upload .js-upload-label",U),T=I(".js-continue-button, .btnPhotoUploadSave",U);if(S){vBulletin.upload.changeButtonText(R,vBulletin.phrase.get("upload_more"))}else{vBulletin.upload.restoreButtonText(R)}T.toggle(S)};function L(){I(document).off("click.removephoto",".photo-display .photo-item .remove-icon").on("click.removephoto",".photo-display .photo-item .remove-icon",function(){var S=I(this).closest(".photo-item-wrapper"),W=I(".filedataid",S).data("nodeid"),V=S.parents(".js-photo-display").last();if(typeof W!=="undefined"){var U=I.inArray(W,N);if(U!=-1){N.splice(U,1)}}S.addClass("h-hide");var R=V.find(".photo-item-wrapper:not(.h-hide)"),T=R.length;if(T<=vBulletin.contentEntryBox.ATTACHLIMIT){I(".js-attach-limit-warning",V).hide()}vBulletin.upload.relocateLastInRowClass(R);if(R.length<=(F*A)){V.parent().removeClass("has-scrollbar");V.dialog("option","width",V.data("orig-width"))}vBulletin.upload.updateButtons(V,(R.length>0))});I(document).off("blur.photocaption",".photo-display .photo-caption .caption-box").on("blur.photocaption",".photo-display .photo-caption .caption-box",function(){I(this).scrollTop(0)});vBulletin.conversation.bindEditFormEventHandlers("gallery")}function E(R){I(this).replaceWith(R)}function H(){var R=jQuery.fn.fileupload;jQuery.fn.fileupload=function(){if(arguments&&arguments[0]&&arguments[0].dropZone&&arguments[0].dropZone=="vb-self"){arguments[0].dropZone=I(this)}if(arguments&&arguments[0]&&arguments[0].dropZone){arguments[0].dropZone.addClass("js-fileupload-dropzone")}var S=R.apply(this,arguments);return S}}function G(){if("FormData" in window&&"FileReader" in window){var R=document.createElement("div");if("draggable" in R||("ondragstart" in R&&"ondrop" in R)){return true}}return false}function B(S){if(S.data("vb-dropzone-overlay-initialized")){return }var R=I("<div />").html(vBulletin.phrase.get("drop_files_here_to_upload")).addClass("h-hide-imp js-fileupload-dropzone-overlay fileupload-dropzone-overlay").appendTo(S);S.css("position","relative").data("vb-dropzone-overlay-initialized","1")}function D(){I(".cke_contents").each(function(){var S=I(this),R=S.find(".js-fileupload-dropzone-ckeditor-overlay");if(!R.length){var R=I("<div />").addClass("h-hide-imp js-fileupload-dropzone-ckeditor-overlay fileupload-dropzone-ckeditor-overlay").appendTo(S)}})}function P(R){if(!R){I(".js-fileupload-dropzone-overlay").addClass("h-hide-imp");I(".js-fileupload-dropzone-ckeditor-overlay").addClass("h-hide-imp")}else{R.each(function(){var S=I(this);B(S);D();S.find(".js-fileupload-dropzone-overlay").removeClass("h-hide-imp");I(".js-fileupload-dropzone-ckeditor-overlay").removeClass("h-hide-imp")})}}function C(U){var R=I(".js-fileupload-dropzone"),T=R.filter(":visible"),S=R.filter(".b-content-entry-panel__content--attachment");U.preventDefault();if(R.length<1){return }if(T.length==0&&S.length==1){I(".js-content-entry").find(".js-toolbar-secondary .b-toolbar__item").filter(function(){return(I(this).data("panel")=="b-content-entry-panel__content--attachment")}).click();T=R.filter(":visible")}if(T.length>0){P(T);U.originalEvent.dataTransfer.dropEffect="none";U.originalEvent.dataTransfer.effectAllowed="none";I(".js-fileupload-dropzone-overlay").removeClass("fileupload-dropzone-overlay--active");I(U.target).parents().each(function(){var V=I(this);if(V.is(".js-fileupload-dropzone")){V.find(".js-fileupload-dropzone-overlay").addClass("fileupload-dropzone-overlay--active");U.originalEvent.dataTransfer.dropEffect="copy";U.originalEvent.dataTransfer.effectAllowed="copy";return false}})}}function K(R){R.preventDefault();P(false)}function M(){if(O){window.clearTimeout(O);O=0}}function Q(S){var R=this;O=window.setTimeout(function(){K.call(R,S)},200)}function J(){if(G()){I(document).off("dragover",C).on("dragover",C);I(document).off("drop dragend",K).on("drop dragend",K);I(document).off("dragenter dragover",M).on("dragenter dragover",M);I(document).off("dragleave",Q).on("dragleave",Q)}}I(document).ready(function(){H();J();vBulletin.upload.initializePhotoUpload();L()})})(jQuery);