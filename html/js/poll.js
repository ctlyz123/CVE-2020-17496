/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["vote_failed","vote_now","vote_first","vote_error_retrieving","votes","vote","voters","voter"]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,["maxpolloptions"]);(function(A){A(document).ready(function(){function E(G){var F=function(H){H.find(".js-remove-button").prop("disabled",(H.find("li").length<=2))};A(".b-poll-fieldset__poll-answers").each(function(){F(A(this))});G.off("click",".js-poll__view-results").on("click",".js-poll__view-results",function(J){J.preventDefault();var I=A(this).attr("data-nodeid"),H=A(this).closest("form");A.post(vBulletin.getAjaxBaseurl()+"/poll/get",{nodeid:I},function(K){B(H,K)},"json")});G.off("click",".js-poll__back-to-poll").on("click",".js-poll__back-to-poll",function(I){I.preventDefault();var H=A(this).closest(".js-poll__parent");H.find("div.pollresults").addClass("h-hide");H.find("form.poll").show()});G.off("click",".b-poll-fieldset__add-more").on("click",".b-poll-fieldset__add-more",function(J){var K=A(this),I=K.prev(".b-poll-fieldset__poll-answers"),H=I.find("li").first().clone(true);H.find(".b-form-input__input").val("").attr("name","polloptions[new][]");H.appendTo(I).find(".b-form-input__input").focus();if(I.find("li").length==vBulletin.options.get("maxpolloptions")){K.addClass("h-hide")}F(I);return false});G.off("click",".b-poll-fieldset__poll-answers .js-remove-button").on("click",".b-poll-fieldset__poll-answers .js-remove-button",function(){var I=A(this),H=I.closest(".b-poll-fieldset__poll-answers");I.closest("li").remove();H.next(".b-poll-fieldset__add-more").removeClass("h-hide");F(H);return false});G.off("click",".js-poll-timeout").on("click",".js-poll-timeout",function(I){var H=A(this).closest(".b-poll-fieldset__poll-options").next(".b-poll-fieldset__datepicker-container");if(this.checked){H.removeClass("h-hide")}else{H.addClass("h-hide").find(".b-datepicker__input").val("")}});G.off("submit.formpoll","form.poll").on("submit.formpoll","form.poll",function(K){K.preventDefault();var H=A(this);var J=H.find('[name="polloptionid"]:checked').val();var I=[];H.find('[name="polloptionids[]"]:checked').each(function(){I.push(A(this).val())});A.post(vBulletin.normalizeAjaxUrl(H.attr("action")),{polloptionid:J,"polloptionids[]":I},function(M){if(M==false){vBulletin.warning("vote_now","vote_failed")}else{B(H,M);var L=H.parent();A("div.pollresults",L).find(".js-poll__back-to-poll").remove()}},"json")});A(document).off("click",".pollresults-data .voter-icon").on("click",".pollresults-data .voter-icon",function(){var H=A(this);if(H.find(".voters").is(":visible")){return false}A(".pollresults-data tr td.pollvoter-cell .voter-icon .voters").hide();var K=H.attr("data-node-id"),J=H.attr("data-polloption-id"),I=H.closest("form");A.post(vBulletin.getAjaxBaseurl()+"/poll/get-voters",{nodeid:K,polloptionid:J},function(L){if(L){if(!L.error){C(I,L,J,H)}else{D({message:L.error,type:"error"},H)}}else{D({message:vBulletin.phrase.get("vote_error_retrieving"),type:"error"},H)}},"json")});A(document).off("click",".pollresults-data .voter-icon .voters").on("click",".pollresults-data .voter-icon .voters",function(){e.stopPropagation();return true})}vBulletin.conversation.bindEditFormEventHandlers("poll");function D(H,G){var I=G.find(".voters");if(H.message){var F=A("<span />").addClass(H.type).text(H.message);I.html(F)}else{I.html(H.voters)}I.fadeIn("slow");A("body").on("click.voterpopup",function(J){if(A(J.target).closest(".voter-icon").length==0){I.hide();A("body").off("click.voterpopup")}})}function C(F,H,K,I){var M=false;if(H.options){B(F,H);var J=H.options[K];if(J){M=true;if(!A.isEmptyObject(J.votersinfo)){var L=[];for(var G in J.votersinfo){L.push('<a href="{0}">{1}</a>'.format(pageData.baseurl+J.votersinfo[G].profileUrl,J.votersinfo[G].username))}D({voters:L.join(", ")},I)}else{D({message:vBulletin.phrase.get("vote_first"),type:"note"},I)}}}if(!M){D({message:vBulletin.phrase.get("vote_error_retrieving"),type:"error"},I)}}function B(G,L){var F=G.parent(),H=L.options,K="";for(var I in H){var J=A(".pollresults-option-"+H[I].polloptionid);J.find(".title").html(JShtmlEncode(H[I].title));J.find(".bar-container .bar").css("width",H[I].percentage+"%");J.find(".percentage").html(H[I].display_percentage+"%");J.find(".votes span").html(H[I].votes);if(H[I].votes==1){K="vote"}else{K="votes"}J.find(".votes label").html(vBulletin.phrase.get(K))}A(".pollresults .pollvote-count span",F).html(L.poll_votes);if(L.poll_votes==1){K="voter"}else{K="voters"}A(".pollresults .pollvote-count label",F).html(vBulletin.phrase.get(K));G.hide();A("div.pollresults",F).removeClass("h-hide")}E(A(document))})})(jQuery);