/*=======================================================================*\
|| ###################################################################### ||
|| # vBulletin 5.6.0
|| # ------------------------------------------------------------------ # ||
|| # Copyright 2000-2020 MH Sub I, LLC dba vBulletin. All Rights Reserved.  # ||
|| # This file may not be redistributed in whole or significant part.   # ||
|| # ----------------- VBULLETIN IS NOT FREE SOFTWARE ----------------- # ||
|| # http://www.vbulletin.com | http://www.vbulletin.com/license.html   # ||
|| ###################################################################### ||
\*========================================================================*/
window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["channel_deleted_confirmation","confirm_delete","confirm_delete_channel_has_x_posts_y_forums","emails_sent_successfully","enter_email_message_and_recipients","forum_created","forum_deleted","forum_description_updated","forum_title_updated","home_page_changed","logo_changed","no_permission","unable_to_update_home_page_route",]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,[]);(function(D){var C=false,P=function(U){var T=this;vBulletin.assertUserHasAdminPermission("canusesitebuilder",T,function(){var V=D(".js-top-menu-tab--quicksetup").get(0);vBulletin.sitebuilder.activateSB.apply(V);L.call(T,U)});return false},L=function(W){var V=D(this),U=D(document.body),T=!V.hasClass("b-top-menu__item-link--selected");if(T){D(document.body).addClass("js-edit-mode-style");B();D(".js-config-site-panel").css("display","none").removeClass("h-hide").slideDown(400,G)}else{D(".js-config-site-panel").slideUp(function(){R(!T,V);D(document.body).removeClass("js-edit-mode-style");var X=window.location.href;if(X.indexOf("adminAction=quickConfig&")!=-1){X=X.replace("adminAction=quickConfig&","")}else{X=X.replace("?adminAction=quickConfig","")}if(X!=window.location.href){window.location.href=X}else{window.location.reload(true)}})}},R=function(T,U){D(document).trigger("vb-toggle-sitebuilder-menu",{enableButtons:T,currentButton:U})},J=function(T){if(D(T.target).is(".js-site-config__upload_file")){D(".js-site-config__fileForm").removeClass("h-hide");D(".js-site-config__urlForm").addClass("h-hide");D(".js-site-config__upload_url").attr("checked",false)}else{D(".js-site-config__urlForm").removeClass("h-hide");D(".js-site-config__fileForm").addClass("h-hide");D(".js-site-config__upload_file").attr("checked",false)}},N=function(){L.call(D(".js-top-menu-tab--quicksetup").get(0))},O=function(){D(".js-config-site-panel").fileupload({dropZone:D(".js-site-config__upload-logo"),dataType:"json",add:function(U,T){D("body").css("cursor","wait");D(".js-config-site-panel").find(".js-upload-progress:first").removeClass("h-hide");T.submit()},done:function(U,T){if(T.result&&T.result.filedataid){D("#header .site-logo img").attr({src:T.result.imageUrl,"data-fileid":T.result.filedataid,"data-styleselection":D("#edit-site-logo-dialog .styleselection:checked").val()});vBulletin.flashMessage(vBulletin.phrase.get("logo_changed"))}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})}},fail:function(U,T){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})},always:function(U,T){D("body").css("cursor","auto");D(".js-config-site-panel").find(".js-upload-progress:first").addClass("h-hide")}})},A=function(){var T=D.trim(D(".js-site-config__url_form .js-site-config__url").val());if(T){D("body").css("cursor","wait");D(this).closest(".dialog-content").find(".js-upload-progress:last").removeClass("h-hide");vBulletin.AJAX({call:"/uploader/upload-logo-url",data:({urlupload:T}),complete:function(){console.log("uploader/url complete.");D("body").css("cursor","auto");D(".js-config-site-panel .js-upload-progress:last").addClass("h-hide")},success:function(U){console.log("saving site logo successful! result:"+U);D("#header .site-logo img").attr({src:U.imageUrl,"data-fileid":U.filedataid,"data-styleselection":D("#edit-site-logo-dialog .styleselection:checked").val()});vBulletin.flashMessage(vBulletin.phrase.get("logo_changed"))},error:function(){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_processing_site_logo"),iconType:"error",onAfterClose:function(){D(".js-site-config__url").focus()}})}})}else{D("#edit-site-logo-dialog #imageUrl").focus()}},I=function(){var T=D(".js-site-config__homepage-container");vBulletin.AJAX({call:"/ajax/render/admin_configuresite_homepage_list",data:{isAjaxTemplateRenderWithData:true,},error:function(){var U=D("<div />").addClass("b-config-site__message").text(vBulletin.phrase.get("error_fetching_home_page_options"));T.html(U)},success:function(U){T.html(U.template);D(document).off("click",".js-site-config__homepage-opt").on("click",".js-site-config__homepage-opt",K);D(document).off("click",".js-site-config__revert-to-custom").on("click",".js-site-config__revert-to-custom",F);if(vBulletin.vBScroller&&vBulletin.vBScroller.initializeScroller){var V=T.find(".js-vbscroller-wrapper");vBulletin.vBScroller.initializeScroller(V)}}})},K=function(V){var T=D(V.target).closest(".js-site-config__homepage-opt"),U=T.data("routeid");if(T.is(".b-config-site__homepage-opt--selected")){return }vBulletin.AJAX({call:"/ajax/api/route/setAsHomeRoute",data:{routeid:U,},error_phrase:"unable_to_update_home_page_route",success:function(W){if(W.success&&W.routeid==U){D(".js-site-config__homepage-opt").removeClass("b-config-site__homepage-opt--selected");T.addClass("b-config-site__homepage-opt--selected");D(".js-site-config__homepage-custom-current").addClass("h-hide");D(".js-site-config__homepage-custom-prev").removeClass("h-hide");vBulletin.flashMessage(vBulletin.phrase.get("home_page_changed"))}else{vBulletin.error("error","unable_to_update_home_page_route")}}})},F=function(V){var T=D(V.target),U=T.data("routeid");vBulletin.AJAX({call:"/ajax/api/route/setAsHomeRoute",data:{routeid:U,},error_phrase:"unable_to_update_home_page_route",success:function(W){if(W.success&&W.routeid==U){D(".js-site-config__homepage-opt").removeClass("b-config-site__homepage-opt--selected");D(".js-site-config__homepage-custom-current").removeClass("h-hide");D(".js-site-config__homepage-custom-prev").addClass("h-hide")}else{vBulletin.error("error","unable_to_update_home_page_route")}}});return false},M=function(V){var W=D(V.target),U=W.data("nodeid");if(typeof (U)=="undefined"){D(V.currentTarget).hide()}else{var T=W.data("postcount")||0;vBulletin.AJAX({call:"/ajax/api/search/getInitialResults",data:{search_json:{channel:U,type:"vBForum_Channel"},perpage:100},title_phrase:"error",error_phrase:"error_deleting_forum",success:function(X){if(X&&X.totalRecords){subforums=X.totalRecords}else{subforums=0}openConfirmDialog({title:vBulletin.phrase.get("confirm_delete"),message:vBulletin.phrase.get("confirm_delete_channel_has_x_posts_y_forums",T,subforums),iconType:"warning",onClickYes:function(){vBulletin.AJAX({call:"/ajax/api/content_channel/delete",data:{nodeid:U},title_phrase:"error",error_phrase:"error_deleting_forum",success:function(Y){D(V.target).closest(".js-site-config__forum-record").html(vBulletin.phrase.get("channel_deleted_confirmation")).addClass("h-margin-bottom-xxl");vBulletin.flashMessage(vBulletin.phrase.get("forum_deleted"))}})},})}})}},S=function(){var T=D(".js-site-config__more-forums-sample").find(".js-site-config__forum-record").clone();D(".js-site-config__forum-div").append(T);D(".js-site-config__forum-div .autogrow").last().elastic().off("blur.elastic")},B=function(){D(".js-site-config__upload_file").trigger("click")},Q=function(Y){var V=D(Y.target),T=V.val(),X=V.data("nodeid");if(T==""){return }if(X){vBulletin.AJAX({call:"/ajax/api/content_channel/update",title_phrase:"error",error_phrase:"error_updating_forum",data:{nodeid:X,data:{title:T}},success:function(Z){console.log("update channels successful:"+Z);vBulletin.flashMessage(vBulletin.phrase.get("forum_title_updated"))}})}else{var W={title:T},U=V.closest(".js-site-config__forum-record").find(".b-config-site__forum-desc");if(U.length>0){W.description=U.val()}vBulletin.AJAX({call:"/createcontent/channel",title_phrase:"error",error_phrase:"error_updating_forum",data:W,success:function(Z){console.log("add channels successful:"+Z);V.data("nodeid",Z.nodeid);if(Z.candelete){V.closest(".js-site-config__forum-record").find(".b-config-site__delete-link").removeClass("h-hide h-hide-imp").data("nodeid",Z.nodeid)}D(document).trigger("vbulletin-quicksetup-forumcreated",{nodeid:Z.nodeid});vBulletin.flashMessage(vBulletin.phrase.get("forum_created"))}})}},H=function(W){var T=D(W.target),V=T.closest(".js-site-config__forum-record").find(".b-config-site__forum-title");if(!V.data("nodeid")){var U=this;D(document).one("vbulletin-quicksetup-forumcreated",function(){H.call(U,W)});return }vBulletin.AJAX({call:"/ajax/api/content_channel/update",title_phrase:"error",error_phrase:"error_updating_forum",data:{nodeid:V.data("nodeid"),data:{description:T.val()}},success:function(X){console.log("update channel successful:"+X);vBulletin.flashMessage(vBulletin.phrase.get("forum_description_updated"))}})},E=function(){var V=D(".b-config-site__email-list").val(),U=D(".b-config-site__email-title").val(),T=D(".b-config-site__email-content").val();if(V.length<4||T.length<4){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("enter_message_and_recipients"),iconType:"error"})}else{vBulletin.AJAX({call:"/ajax/api/mail/send",title_phrase:"error",error_phrase:"error_sending_email",data:{to:V,subject:U,message:T},success:function(W){if(W.success){vBulletin.flashMessage(vBulletin.phrase.get("emails_sent_successfully"))}else{if(W.message){vBulletin.error("error",W.message)}}console.log("messages sent successfully")}})}},G=function(){if(C){return }O();D(document).off("click",".js-site-config__upload_file, .js-site-config__upload_url").on("click",".js-site-config__upload_file, .js-site-config__upload_url",J);D(document).off("click",".js-site-config__btn-url").on("click",".js-site-config__btn-url",A);D(document).off("click",".b-config-site__delete-link").on("click",".b-config-site__delete-link",M);D(document).off("click",".js-site-config__more-forums").on("click",".js-site-config__more-forums",S);D(document).off("change",".b-config-site__forum-title").on("change",".b-config-site__forum-title",Q);D(document).off("change",".b-config-site__forum-desc").on("change",".b-config-site__forum-desc",H);D(document).off("click",".js-site-config__send-btn").on("click",".js-site-config__send-btn",E);D(document).off("click",".js-site-config__close-btn").on("click",".js-site-config__close-btn",N);D(".js-config-site-panel .autogrow").each(function(){D(this).elastic().off("blur.elastic")});D(".js-site-config__more-forums").click();if(D(".js-config-site-panel .js-theme-selector__container").length==1){window.vBulletin.sitebuilder.initThemesInQuickConfig()}I();C=true};D(function(){D(document).on("vb-sitebuilder-panel--quicksetup",P);if(typeof (pageData.adminAction)!="undefined"&&pageData.adminAction=="quickConfig"){D(".js-config-site").click()}})})(jQuery);