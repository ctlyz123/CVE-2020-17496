<?xml version="1.0" encoding="UTF-8"?>
<!-- This file is to support redirection in IIS.
This file is harmless if you are running under Apache -->
<configuration>
	<system.webServer>
		<rewrite>
			<rules>
				<clear /> <!-- reset other rewrite rules -->
				<!-- Remove this line for secure server redirection
				<rule name="Redirect to https" stopProcessing="true">
					<match url=".*" />
					<conditions>
						<add input="{HTTPS}" pattern="off" ignoreCase="true" />
					</conditions>
					<action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" redirectType="Permanent" appendQueryString="false" />
				</rule>
				Remove this line for secure server redirection -->				
				
				<rule name="Css" stopProcessing="true">
					<match url="^css.php$" ignoreCase="false" />
					<action type="Rewrite" url="core/css.php" />
				</rule>

				<rule name="Installer" stopProcessing="true">
					<match url="^install/" ignoreCase="true" />
					<action type="Rewrite" url="core/install/" />
				</rule>

				<rule name="BlockDirs" stopProcessing="true">
					<match url="^(core/libraries/|includes|core/includes|core/vb|core/vb5|core/admincp|core/modcp)" ignoreCase="true" />
					<action type="Rewrite" url="index.php?routestring=relay/404" />
				</rule>
				
				<rule name="BlockDotDirs" stopProcessing="true">
					<match url="(^|/)\.(?!well-known)" ignoreCase="true" />
					<action type="Rewrite" url="index.php?routestring=relay/404" />
				</rule>

				<rule name="BlockPHPDirs" stopProcessing="true">
					<match url="^(css|fonts|images|js|core/cache|core/cpstyles|core/clientscript|core/customavatars|core/images|core/store_sitemap)/.*\.php" ignoreCase="true" />
					<action type="Rewrite" url="index.php?routestring=relay/404" />
				</rule>
				
				<rule name="Main Redirect" stopProcessing="true">
					<match url="^(.*)$" ignoreCase="false" />
					<conditions logicalGrouping="MatchAll">
						<add input="{REQUEST_FILENAME}" matchType="IsFile" ignoreCase="false" negate="true" />
						<add input="{REQUEST_FILENAME}" matchType="IsDirectory" ignoreCase="false" negate="true" />
					</conditions>

					<action type="Rewrite" url="index.php?routestring={R:1}" />
				</rule>

				<rule name="Admincp" stopProcessing="true">
					<match url="^(admincp/)$" ignoreCase="false" />
					<action type="Rewrite" url="index.php?routestring={R:1}" />
				</rule>
			</rules>
		</rewrite>
	</system.webServer>
</configuration>
